"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createServiceAccountWithPolicy = exports.createServiceAccount = void 0;
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
/**
 * Creates a service account that can access secrets
 * @param clusterInfo
 * @returns sa
 */
function createServiceAccount(cluster, name, namespace, policyDocument) {
    const policy = new aws_iam_1.ManagedPolicy(cluster, `${name}-managed-policy`, {
        document: policyDocument
    });
    return createServiceAccountWithPolicy(cluster, name, namespace, policy);
}
exports.createServiceAccount = createServiceAccount;
function createServiceAccountWithPolicy(cluster, name, namespace, policy) {
    const sa = cluster.addServiceAccount(`${name}-sa`, {
        name: name,
        namespace: namespace
    });
    sa.role.addManagedPolicy(policy);
    return sa;
}
exports.createServiceAccountWithPolicy = createServiceAccountWithPolicy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2EtdXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9saWIvdXRpbHMvc2EtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaURBQW9GO0FBRXBGOzs7O0dBSUc7QUFDSCxTQUFnQixvQkFBb0IsQ0FBQyxPQUFnQixFQUFFLElBQVksRUFBRSxTQUFpQixFQUFFLGNBQThCO0lBQ2xILE1BQU0sTUFBTSxHQUFHLElBQUksdUJBQWEsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLGlCQUFpQixFQUFFO1FBQ2hFLFFBQVEsRUFBRSxjQUFjO0tBQzNCLENBQUMsQ0FBQztJQUVILE9BQU8sOEJBQThCLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFFNUUsQ0FBQztBQVBELG9EQU9DO0FBRUQsU0FBZ0IsOEJBQThCLENBQUMsT0FBZ0IsRUFBRSxJQUFZLEVBQUUsU0FBaUIsRUFBRSxNQUFzQjtJQUNwSCxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsR0FBRyxJQUFJLEtBQUssRUFBRTtRQUMvQyxJQUFJLEVBQUUsSUFBSTtRQUNWLFNBQVMsRUFBRSxTQUFTO0tBQ3ZCLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFakMsT0FBTyxFQUFFLENBQUM7QUFDZCxDQUFDO0FBVEQsd0VBU0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbHVzdGVyLCBTZXJ2aWNlQWNjb3VudCB9IGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtZWtzXCI7XG5pbXBvcnQgeyBQb2xpY3lEb2N1bWVudCwgTWFuYWdlZFBvbGljeSwgSU1hbmFnZWRQb2xpY3kgfSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWlhbVwiO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBzZXJ2aWNlIGFjY291bnQgdGhhdCBjYW4gYWNjZXNzIHNlY3JldHNcbiAqIEBwYXJhbSBjbHVzdGVySW5mbyBcbiAqIEByZXR1cm5zIHNhXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTZXJ2aWNlQWNjb3VudChjbHVzdGVyOiBDbHVzdGVyLCBuYW1lOiBzdHJpbmcsIG5hbWVzcGFjZTogc3RyaW5nLCBwb2xpY3lEb2N1bWVudDogUG9saWN5RG9jdW1lbnQpOiBTZXJ2aWNlQWNjb3VudCB7XG4gICAgY29uc3QgcG9saWN5ID0gbmV3IE1hbmFnZWRQb2xpY3koY2x1c3RlciwgYCR7bmFtZX0tbWFuYWdlZC1wb2xpY3lgLCB7XG4gICAgICAgIGRvY3VtZW50OiBwb2xpY3lEb2N1bWVudFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNyZWF0ZVNlcnZpY2VBY2NvdW50V2l0aFBvbGljeShjbHVzdGVyLCBuYW1lLCBuYW1lc3BhY2UsIHBvbGljeSk7XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNlcnZpY2VBY2NvdW50V2l0aFBvbGljeShjbHVzdGVyOiBDbHVzdGVyLCBuYW1lOiBzdHJpbmcsIG5hbWVzcGFjZTogc3RyaW5nLCBwb2xpY3k6IElNYW5hZ2VkUG9saWN5KTogU2VydmljZUFjY291bnQge1xuICAgIGNvbnN0IHNhID0gY2x1c3Rlci5hZGRTZXJ2aWNlQWNjb3VudChgJHtuYW1lfS1zYWAsIHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2VcbiAgICB9KTtcblxuICAgIHNhLnJvbGUuYWRkTWFuYWdlZFBvbGljeShwb2xpY3kpO1xuICAgIFxuICAgIHJldHVybiBzYTtcbn1cbiJdfQ==