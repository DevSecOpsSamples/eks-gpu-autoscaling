"use strict";var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CompositePrincipal=exports.StarPrincipal=exports.Anyone=exports.AnyPrincipal=exports.AccountRootPrincipal=exports.SamlConsolePrincipal=exports.SamlPrincipal=exports.OpenIdConnectPrincipal=exports.WebIdentityPrincipal=exports.FederatedPrincipal=exports.CanonicalUserPrincipal=exports.OrganizationPrincipal=exports.ServicePrincipal=exports.AccountPrincipal=exports.ArnPrincipal=exports.PrincipalPolicyFragment=exports.SessionTagsPrincipal=exports.PrincipalWithConditions=exports.PrincipalBase=void 0;const jsiiDeprecationWarnings=require("../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),cdk=require("../../core"),region_info_1=require("../../region-info"),policy_statement_1=require("./policy-statement"),assume_role_policy_1=require("./private/assume-role-policy"),util_1=require("./util");class PrincipalBase{constructor(){this.grantPrincipal=this,this.principalAccount=void 0,this.assumeRoleAction="sts:AssumeRole"}addToPolicy(statement){return jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_PolicyStatement(statement),this.addToPrincipalPolicy(statement).statementAdded}addToPrincipalPolicy(_statement){return jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_PolicyStatement(_statement),{statementAdded:!1}}addToAssumeRolePolicy(document){jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_PolicyDocument(document),document.addStatements(new policy_statement_1.PolicyStatement({actions:[this.assumeRoleAction],principals:[this]}))}toString(){return JSON.stringify(this.policyFragment.principalJson)}toJSON(){return this.policyFragment.principalJson}withConditions(conditions){return new PrincipalWithConditions(this,conditions)}withSessionTags(){return new SessionTagsPrincipal(this)}}exports.PrincipalBase=PrincipalBase,_a=JSII_RTTI_SYMBOL_1,PrincipalBase[_a]={fqn:"aws-cdk-lib.aws_iam.PrincipalBase",version:"2.20.0"};class PrincipalAdapter extends PrincipalBase{constructor(wrapped){super();this.wrapped=wrapped,this.assumeRoleAction=this.wrapped.assumeRoleAction,this.principalAccount=this.wrapped.principalAccount}get policyFragment(){return this.wrapped.policyFragment}addToPolicy(statement){return this.wrapped.addToPolicy(statement)}addToPrincipalPolicy(statement){return this.wrapped.addToPrincipalPolicy(statement)}}class PrincipalWithConditions extends PrincipalAdapter{constructor(principal,conditions){super(principal);jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_IPrincipal(principal),this.additionalConditions=conditions}addCondition(key,value){const existingValue=this.additionalConditions[key];this.additionalConditions[key]=existingValue?{...existingValue,...value}:value}addConditions(conditions){Object.entries(conditions).forEach(([key,value])=>{this.addCondition(key,value)})}get conditions(){return this.mergeConditions(this.wrapped.policyFragment.conditions,this.additionalConditions)}get policyFragment(){return new PrincipalPolicyFragment(this.wrapped.policyFragment.principalJson,this.conditions)}toString(){return this.wrapped.toString()}toJSON(){return this.policyFragment.principalJson}mergeConditions(principalConditions,additionalConditions){const mergedConditions={};return Object.entries(principalConditions).forEach(([operator,condition])=>{mergedConditions[operator]=condition}),Object.entries(additionalConditions).forEach(([operator,condition])=>{const existing=mergedConditions[operator];if(!existing){mergedConditions[operator]=condition;return}if(cdk.Token.isUnresolved(condition)||cdk.Token.isUnresolved(existing))throw new Error(`multiple "${operator}" conditions cannot be merged if one of them contains an unresolved token`);mergedConditions[operator]={...existing,...condition}}),mergedConditions}}exports.PrincipalWithConditions=PrincipalWithConditions,_b=JSII_RTTI_SYMBOL_1,PrincipalWithConditions[_b]={fqn:"aws-cdk-lib.aws_iam.PrincipalWithConditions",version:"2.20.0"};class SessionTagsPrincipal extends PrincipalAdapter{constructor(principal){super(principal);jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_IPrincipal(principal)}addToAssumeRolePolicy(doc){jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_PolicyDocument(doc);const adapter=require("./private/policydoc-adapter");assume_role_policy_1.defaultAddPrincipalToAssumeRole(this.wrapped,new adapter.MutatingPolicyDocumentAdapter(doc,statement=>(statement.addActions("sts:TagSession"),statement)))}}exports.SessionTagsPrincipal=SessionTagsPrincipal,_c=JSII_RTTI_SYMBOL_1,SessionTagsPrincipal[_c]={fqn:"aws-cdk-lib.aws_iam.SessionTagsPrincipal",version:"2.20.0"};class PrincipalPolicyFragment{constructor(principalJson,conditions={}){this.principalJson=principalJson,this.conditions=conditions}}exports.PrincipalPolicyFragment=PrincipalPolicyFragment,_d=JSII_RTTI_SYMBOL_1,PrincipalPolicyFragment[_d]={fqn:"aws-cdk-lib.aws_iam.PrincipalPolicyFragment",version:"2.20.0"};class ArnPrincipal extends PrincipalBase{constructor(arn){super();this.arn=arn}get policyFragment(){return new PrincipalPolicyFragment({AWS:[this.arn]})}toString(){return`ArnPrincipal(${this.arn})`}}exports.ArnPrincipal=ArnPrincipal,_e=JSII_RTTI_SYMBOL_1,ArnPrincipal[_e]={fqn:"aws-cdk-lib.aws_iam.ArnPrincipal",version:"2.20.0"};class AccountPrincipal extends ArnPrincipal{constructor(accountId){super(new StackDependentToken(stack=>`arn:${stack.partition}:iam::${accountId}:root`).toString());this.accountId=accountId,this.principalAccount=accountId}toString(){return`AccountPrincipal(${this.accountId})`}}exports.AccountPrincipal=AccountPrincipal,_f=JSII_RTTI_SYMBOL_1,AccountPrincipal[_f]={fqn:"aws-cdk-lib.aws_iam.AccountPrincipal",version:"2.20.0"};class ServicePrincipal extends PrincipalBase{constructor(service,opts={}){super();this.service=service,this.opts=opts,jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_ServicePrincipalOpts(opts)}get policyFragment(){return new PrincipalPolicyFragment({Service:[new ServicePrincipalToken(this.service,this.opts).toString()]},this.opts.conditions)}toString(){return`ServicePrincipal(${this.service})`}}exports.ServicePrincipal=ServicePrincipal,_g=JSII_RTTI_SYMBOL_1,ServicePrincipal[_g]={fqn:"aws-cdk-lib.aws_iam.ServicePrincipal",version:"2.20.0"};class OrganizationPrincipal extends PrincipalBase{constructor(organizationId){super();this.organizationId=organizationId}get policyFragment(){return new PrincipalPolicyFragment({AWS:["*"]},{StringEquals:{"aws:PrincipalOrgID":this.organizationId}})}toString(){return`OrganizationPrincipal(${this.organizationId})`}}exports.OrganizationPrincipal=OrganizationPrincipal,_h=JSII_RTTI_SYMBOL_1,OrganizationPrincipal[_h]={fqn:"aws-cdk-lib.aws_iam.OrganizationPrincipal",version:"2.20.0"};class CanonicalUserPrincipal extends PrincipalBase{constructor(canonicalUserId){super();this.canonicalUserId=canonicalUserId}get policyFragment(){return new PrincipalPolicyFragment({CanonicalUser:[this.canonicalUserId]})}toString(){return`CanonicalUserPrincipal(${this.canonicalUserId})`}}exports.CanonicalUserPrincipal=CanonicalUserPrincipal,_j=JSII_RTTI_SYMBOL_1,CanonicalUserPrincipal[_j]={fqn:"aws-cdk-lib.aws_iam.CanonicalUserPrincipal",version:"2.20.0"};class FederatedPrincipal extends PrincipalBase{constructor(federated,conditions,assumeRoleAction="sts:AssumeRole"){super();this.federated=federated,this.conditions=conditions,this.assumeRoleAction=assumeRoleAction}get policyFragment(){return new PrincipalPolicyFragment({Federated:[this.federated]},this.conditions)}toString(){return`FederatedPrincipal(${this.federated})`}}exports.FederatedPrincipal=FederatedPrincipal,_k=JSII_RTTI_SYMBOL_1,FederatedPrincipal[_k]={fqn:"aws-cdk-lib.aws_iam.FederatedPrincipal",version:"2.20.0"};class WebIdentityPrincipal extends FederatedPrincipal{constructor(identityProvider,conditions={}){super(identityProvider,conditions!=null?conditions:{},"sts:AssumeRoleWithWebIdentity")}get policyFragment(){return new PrincipalPolicyFragment({Federated:[this.federated]},this.conditions)}toString(){return`WebIdentityPrincipal(${this.federated})`}}exports.WebIdentityPrincipal=WebIdentityPrincipal,_l=JSII_RTTI_SYMBOL_1,WebIdentityPrincipal[_l]={fqn:"aws-cdk-lib.aws_iam.WebIdentityPrincipal",version:"2.20.0"};class OpenIdConnectPrincipal extends WebIdentityPrincipal{constructor(openIdConnectProvider,conditions={}){super(openIdConnectProvider.openIdConnectProviderArn,conditions!=null?conditions:{});jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_IOpenIdConnectProvider(openIdConnectProvider)}get policyFragment(){return new PrincipalPolicyFragment({Federated:[this.federated]},this.conditions)}toString(){return`OpenIdConnectPrincipal(${this.federated})`}}exports.OpenIdConnectPrincipal=OpenIdConnectPrincipal,_m=JSII_RTTI_SYMBOL_1,OpenIdConnectPrincipal[_m]={fqn:"aws-cdk-lib.aws_iam.OpenIdConnectPrincipal",version:"2.20.0"};class SamlPrincipal extends FederatedPrincipal{constructor(samlProvider,conditions){super(samlProvider.samlProviderArn,conditions,"sts:AssumeRoleWithSAML");jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_ISamlProvider(samlProvider)}toString(){return`SamlPrincipal(${this.federated})`}}exports.SamlPrincipal=SamlPrincipal,_o=JSII_RTTI_SYMBOL_1,SamlPrincipal[_o]={fqn:"aws-cdk-lib.aws_iam.SamlPrincipal",version:"2.20.0"};class SamlConsolePrincipal extends SamlPrincipal{constructor(samlProvider,conditions={}){super(samlProvider,{...conditions,StringEquals:{"SAML:aud":"https://signin.aws.amazon.com/saml"}});jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_ISamlProvider(samlProvider)}toString(){return`SamlConsolePrincipal(${this.federated})`}}exports.SamlConsolePrincipal=SamlConsolePrincipal,_p=JSII_RTTI_SYMBOL_1,SamlConsolePrincipal[_p]={fqn:"aws-cdk-lib.aws_iam.SamlConsolePrincipal",version:"2.20.0"};class AccountRootPrincipal extends AccountPrincipal{constructor(){super(new StackDependentToken(stack=>stack.account).toString())}toString(){return"AccountRootPrincipal()"}}exports.AccountRootPrincipal=AccountRootPrincipal,_q=JSII_RTTI_SYMBOL_1,AccountRootPrincipal[_q]={fqn:"aws-cdk-lib.aws_iam.AccountRootPrincipal",version:"2.20.0"};class AnyPrincipal extends ArnPrincipal{constructor(){super("*")}toString(){return"AnyPrincipal()"}}exports.AnyPrincipal=AnyPrincipal,_r=JSII_RTTI_SYMBOL_1,AnyPrincipal[_r]={fqn:"aws-cdk-lib.aws_iam.AnyPrincipal",version:"2.20.0"};class Anyone extends AnyPrincipal{}exports.Anyone=Anyone,_s=JSII_RTTI_SYMBOL_1,Anyone[_s]={fqn:"aws-cdk-lib.aws_iam.Anyone",version:"2.20.0"};class StarPrincipal extends PrincipalBase{constructor(){super(...arguments);this.policyFragment={principalJson:{[util_1.LITERAL_STRING_KEY]:["*"]},conditions:{}}}toString(){return"StarPrincipal()"}}exports.StarPrincipal=StarPrincipal,_t=JSII_RTTI_SYMBOL_1,StarPrincipal[_t]={fqn:"aws-cdk-lib.aws_iam.StarPrincipal",version:"2.20.0"};class CompositePrincipal extends PrincipalBase{constructor(...principals){super();if(this.principals=new Array,jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_IPrincipal(principals),principals.length===0)throw new Error("CompositePrincipals must be constructed with at least 1 Principal but none were passed.");this.assumeRoleAction=principals[0].assumeRoleAction,this.addPrincipals(...principals)}addPrincipals(...principals){return jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_IPrincipal(principals),this.principals.push(...principals),this}addToAssumeRolePolicy(doc){jsiiDeprecationWarnings.aws_cdk_lib_aws_iam_PolicyDocument(doc);for(const p of this.principals)assume_role_policy_1.defaultAddPrincipalToAssumeRole(p,doc)}get policyFragment(){for(const p of this.principals){const fragment=p.policyFragment;if(fragment.conditions&&Object.keys(fragment.conditions).length>0)throw new Error(`Components of a CompositePrincipal must not have conditions. Tried to add the following fragment: ${JSON.stringify(fragment)}`)}const principalJson={};for(const p of this.principals)util_1.mergePrincipal(principalJson,p.policyFragment.principalJson);return new PrincipalPolicyFragment(principalJson)}toString(){return`CompositePrincipal(${this.principals})`}}exports.CompositePrincipal=CompositePrincipal,_u=JSII_RTTI_SYMBOL_1,CompositePrincipal[_u]={fqn:"aws-cdk-lib.aws_iam.CompositePrincipal",version:"2.20.0"};class StackDependentToken{constructor(fn){this.fn=fn,this.creationStack=cdk.captureStackTrace()}resolve(context){return this.fn(cdk.Stack.of(context.scope))}toString(){return cdk.Token.asString(this)}toJSON(){return"<unresolved-token>"}}class ServicePrincipalToken{constructor(service,opts){this.service=service,this.opts=opts,this.creationStack=cdk.captureStackTrace()}resolve(ctx){var _v;if(this.opts.region)return(_v=region_info_1.RegionInfo.get(this.opts.region).servicePrincipal(this.service))!==null&&_v!==void 0?_v:region_info_1.Default.servicePrincipal(this.service,this.opts.region,cdk.Aws.URL_SUFFIX);const stack=cdk.Stack.of(ctx.scope);return stack.regionalFact(region_info_1.FactName.servicePrincipal(this.service),region_info_1.Default.servicePrincipal(this.service,stack.region,cdk.Aws.URL_SUFFIX))}toString(){return cdk.Token.asString(this,{displayHint:this.service})}toJSON(){return`<${this.service}>`}}
//# sourceMappingURL=principals.js.map
