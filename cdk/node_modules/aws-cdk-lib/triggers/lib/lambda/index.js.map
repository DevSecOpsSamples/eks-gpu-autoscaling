{
  "version": 3,
  "sources": ["index.ts"],
  "sourcesContent": ["/* eslint-disable no-console */\n\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport * as AWS from 'aws-sdk';\n\nexport type InvokeFunction = (functionName: string) => Promise<AWS.Lambda.InvocationResponse>;\n\nexport const invoke: InvokeFunction = async functionName => {\n  const lambda = new AWS.Lambda();\n  const invokeRequest = { FunctionName: functionName };\n  console.log({ invokeRequest });\n  const invokeResponse = await lambda.invoke(invokeRequest).promise();\n  console.log({ invokeResponse });\n  return invokeResponse;\n};\n\nexport async function handler(event: AWSLambda.CloudFormationCustomResourceEvent) {\n  console.log({ event });\n\n  if (event.RequestType === 'Delete') {\n    console.log('not calling trigger on DELETE');\n    return;\n  }\n\n  const handlerArn = event.ResourceProperties.HandlerArn;\n  if (!handlerArn) {\n    throw new Error('The \"HandlerArn\" property is required');\n  }\n\n  const invokeResponse = await invoke(handlerArn);\n\n  if (invokeResponse.StatusCode !== 200) {\n    throw new Error(`Trigger handler failed with status code ${invokeResponse.StatusCode}`);\n  }\n\n  // if the lambda function throws an error, parse the error message and fail\n  if (invokeResponse.FunctionError) {\n    throw new Error(parseError(invokeResponse.Payload?.toString()));\n  }\n};\n\n/**\n * Parse the error message from the lambda function.\n */\nfunction parseError(payload: string | undefined): string {\n  console.log(`Error payload: ${payload}`);\n  if (!payload) { return 'unknown handler error'; }\n  try {\n    const error = JSON.parse(payload);\n    const concat = [error.errorMessage, error.trace].filter(x => x).join('\\n');\n    return concat.length > 0 ? concat : payload;\n  } catch (e) {\n    // fall back to just returning the payload\n    return payload;\n  }\n}\n"],
  "mappings": "0GAGA,KAAA,KAAA,QAAA,SAAA,EAIa,QAAA,OAAyB,KAAM,eAAe,CACzD,KAAM,QAAS,GAAI,KAAI,OACjB,cAAgB,CAAE,aAAc,YAAY,EAClD,QAAQ,IAAI,CAAE,aAAa,CAAE,EAC7B,KAAM,gBAAiB,KAAM,QAAO,OAAO,aAAa,EAAE,QAAO,EACjE,eAAQ,IAAI,CAAE,cAAc,CAAE,EACvB,cACT,EAEO,uBAAuB,MAAkD,QAG9E,GAFA,QAAQ,IAAI,CAAE,KAAK,CAAE,EAEjB,MAAM,cAAgB,SAAU,CAClC,QAAQ,IAAI,+BAA+B,EAC3C,OAGF,KAAM,YAAa,MAAM,mBAAmB,WAC5C,GAAI,CAAC,WACH,KAAM,IAAI,OAAM,uCAAuC,EAGzD,KAAM,gBAAiB,KAAM,SAAA,OAAO,UAAU,EAE9C,GAAI,eAAe,aAAe,IAChC,KAAM,IAAI,OAAM,2CAA2C,eAAe,YAAY,EAIxF,GAAI,eAAe,cACjB,KAAM,IAAI,OAAM,WAAU,IAAC,eAAe,WAAO,MAAA,KAAA,OAAA,OAAA,GAAE,SAAQ,CAAA,CAAG,CAElE,CAvBA,QAAA,QAAA,QA4BA,oBAAoB,QAA2B,CAE7C,GADA,QAAQ,IAAI,kBAAkB,SAAS,EACnC,CAAC,QAAW,MAAO,wBACvB,GAAI,CACF,KAAM,OAAQ,KAAK,MAAM,OAAO,EAC1B,OAAS,CAAC,MAAM,aAAc,MAAM,KAAK,EAAE,OAAO,GAAK,CAAC,EAAE,KAAK;CAAI,EACzE,MAAO,QAAO,OAAS,EAAI,OAAS,aACpC,CAEA,MAAO,SAEX",
  "names": []
}
