"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CfnCodeDeployBlueGreenHook=exports.CfnTrafficRoutingType=void 0;const jsiiDeprecationWarnings=require("../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),cfn_hook_1=require("./cfn-hook"),util_1=require("./util");var CfnTrafficRoutingType;(function(CfnTrafficRoutingType2){CfnTrafficRoutingType2.ALL_AT_ONCE="AllAtOnce",CfnTrafficRoutingType2.TIME_BASED_CANARY="TimeBasedCanary",CfnTrafficRoutingType2.TIME_BASED_LINEAR="TimeBasedLinear"})(CfnTrafficRoutingType=exports.CfnTrafficRoutingType||(exports.CfnTrafficRoutingType={}));class CfnCodeDeployBlueGreenHook extends cfn_hook_1.CfnHook{constructor(scope,id,props){super(scope,id,{type:"AWS::CodeDeploy::BlueGreen"});jsiiDeprecationWarnings.aws_cdk_lib_CfnCodeDeployBlueGreenHookProps(props),this._serviceRole=props.serviceRole,this._applications=props.applications,this._trafficRoutingConfig=props.trafficRoutingConfig,this._additionalOptions=props.additionalOptions,this._lifecycleEventHooks=props.lifecycleEventHooks}static _fromCloudFormation(scope,id,hookAttributes,options){var _b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s;hookAttributes=hookAttributes||{};const hookProperties=options.parser.parseValue(hookAttributes.Properties);return new CfnCodeDeployBlueGreenHook(scope,id,{serviceRole:hookProperties==null?void 0:hookProperties.ServiceRole,applications:(_b=hookProperties==null?void 0:hookProperties.Applications)===null||_b===void 0?void 0:_b.map(applicationFromCloudFormation),trafficRoutingConfig:{type:(_c=hookProperties==null?void 0:hookProperties.TrafficRoutingConfig)===null||_c===void 0?void 0:_c.Type,timeBasedCanary:{stepPercentage:(_e=(_d=hookProperties==null?void 0:hookProperties.TrafficRoutingConfig)===null||_d===void 0?void 0:_d.TimeBasedCanary)===null||_e===void 0?void 0:_e.StepPercentage,bakeTimeMins:(_g=(_f=hookProperties==null?void 0:hookProperties.TrafficRoutingConfig)===null||_f===void 0?void 0:_f.TimeBasedCanary)===null||_g===void 0?void 0:_g.BakeTimeMins},timeBasedLinear:{stepPercentage:(_j=(_h=hookProperties==null?void 0:hookProperties.TrafficRoutingConfig)===null||_h===void 0?void 0:_h.TimeBasedLinear)===null||_j===void 0?void 0:_j.StepPercentage,bakeTimeMins:(_l=(_k=hookProperties==null?void 0:hookProperties.TrafficRoutingConfig)===null||_k===void 0?void 0:_k.TimeBasedLinear)===null||_l===void 0?void 0:_l.BakeTimeMins}},additionalOptions:{terminationWaitTimeInMinutes:(_m=hookProperties==null?void 0:hookProperties.AdditionalOptions)===null||_m===void 0?void 0:_m.TerminationWaitTimeInMinutes},lifecycleEventHooks:{beforeInstall:(_o=hookProperties==null?void 0:hookProperties.LifecycleEventHooks)===null||_o===void 0?void 0:_o.BeforeInstall,afterInstall:(_p=hookProperties==null?void 0:hookProperties.LifecycleEventHooks)===null||_p===void 0?void 0:_p.AfterInstall,afterAllowTestTraffic:(_q=hookProperties==null?void 0:hookProperties.LifecycleEventHooks)===null||_q===void 0?void 0:_q.AfterAllowTestTraffic,beforeAllowTraffic:(_r=hookProperties==null?void 0:hookProperties.LifecycleEventHooks)===null||_r===void 0?void 0:_r.BeforeAllowTraffic,afterAllowTraffic:(_s=hookProperties==null?void 0:hookProperties.LifecycleEventHooks)===null||_s===void 0?void 0:_s.AfterAllowTraffic}});function applicationFromCloudFormation(app){var _b2,_c2,_d2,_e2,_f2,_g2,_h2,_j2,_k2,_l2,_m2,_o2,_p2,_q2,_r2,_s2,_t,_u,_v,_w,_x;const target=findResource((_b2=app==null?void 0:app.Target)===null||_b2===void 0?void 0:_b2.LogicalID),taskDefinitions=(_d2=(_c2=app==null?void 0:app.ECSAttributes)===null||_c2===void 0?void 0:_c2.TaskDefinitions)===null||_d2===void 0?void 0:_d2.map(td=>findResource(td)),taskSets=(_f2=(_e2=app==null?void 0:app.ECSAttributes)===null||_e2===void 0?void 0:_e2.TaskSets)===null||_f2===void 0?void 0:_f2.map(ts=>findResource(ts)),prodTrafficRoute=findResource((_j2=(_h2=(_g2=app==null?void 0:app.ECSAttributes)===null||_g2===void 0?void 0:_g2.TrafficRouting)===null||_h2===void 0?void 0:_h2.ProdTrafficRoute)===null||_j2===void 0?void 0:_j2.LogicalID),testTrafficRoute=findResource((_m2=(_l2=(_k2=app==null?void 0:app.ECSAttributes)===null||_k2===void 0?void 0:_k2.TrafficRouting)===null||_l2===void 0?void 0:_l2.TestTrafficRoute)===null||_m2===void 0?void 0:_m2.LogicalID),targetGroups=(_q2=(_p2=(_o2=app==null?void 0:app.ECSAttributes)===null||_o2===void 0?void 0:_o2.TrafficRouting)===null||_p2===void 0?void 0:_p2.TargetGroups)===null||_q2===void 0?void 0:_q2.map(tg=>findResource(tg));return{target:{type:(_r2=app==null?void 0:app.Target)===null||_r2===void 0?void 0:_r2.Type,logicalId:target==null?void 0:target.logicalId},ecsAttributes:{taskDefinitions:taskDefinitions==null?void 0:taskDefinitions.map(td=>td==null?void 0:td.logicalId),taskSets:taskSets==null?void 0:taskSets.map(ts=>ts==null?void 0:ts.logicalId),trafficRouting:{prodTrafficRoute:{type:(_u=(_t=(_s2=app==null?void 0:app.ECSAttributes)===null||_s2===void 0?void 0:_s2.TrafficRouting)===null||_t===void 0?void 0:_t.ProdTrafficRoute)===null||_u===void 0?void 0:_u.Type,logicalId:prodTrafficRoute==null?void 0:prodTrafficRoute.logicalId},testTrafficRoute:{type:(_x=(_w=(_v=app==null?void 0:app.ECSAttributes)===null||_v===void 0?void 0:_v.TrafficRouting)===null||_w===void 0?void 0:_w.TestTrafficRoute)===null||_x===void 0?void 0:_x.Type,logicalId:testTrafficRoute==null?void 0:testTrafficRoute.logicalId},targetGroups:targetGroups==null?void 0:targetGroups.map(tg=>tg==null?void 0:tg.logicalId)}}}}function findResource(logicalId){if(logicalId==null)return;const ret=options.parser.finder.findResource(logicalId);if(!ret)throw new Error(`Hook '${id}' references resource '${logicalId}' that was not found in the template`);return ret}}get serviceRole(){return this._serviceRole}set serviceRole(serviceRole){this._serviceRole=serviceRole}get applications(){return this._applications}set applications(value){this._applications=value}get trafficRoutingConfig(){return this._trafficRoutingConfig}set trafficRoutingConfig(value){this._trafficRoutingConfig=value}get additionalOptions(){return this._additionalOptions}set additionalOptions(value){this._additionalOptions=value}get lifecycleEventHooks(){return this._lifecycleEventHooks}set lifecycleEventHooks(value){this._lifecycleEventHooks=value}renderProperties(_props){var _b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r;return{ServiceRole:this.serviceRole,Applications:this.applications.map(app=>({Target:{Type:app.target.type,LogicalID:app.target.logicalId},ECSAttributes:{TaskDefinitions:app.ecsAttributes.taskDefinitions,TaskSets:app.ecsAttributes.taskSets,TrafficRouting:{ProdTrafficRoute:{Type:app.ecsAttributes.trafficRouting.prodTrafficRoute.type,LogicalID:app.ecsAttributes.trafficRouting.prodTrafficRoute.logicalId},TestTrafficRoute:{Type:app.ecsAttributes.trafficRouting.testTrafficRoute.type,LogicalID:app.ecsAttributes.trafficRouting.testTrafficRoute.logicalId},TargetGroups:app.ecsAttributes.trafficRouting.targetGroups}}})),TrafficRoutingConfig:util_1.undefinedIfAllValuesAreEmpty({Type:(_b=this.trafficRoutingConfig)===null||_b===void 0?void 0:_b.type,TimeBasedCanary:util_1.undefinedIfAllValuesAreEmpty({StepPercentage:(_d=(_c=this.trafficRoutingConfig)===null||_c===void 0?void 0:_c.timeBasedCanary)===null||_d===void 0?void 0:_d.stepPercentage,BakeTimeMins:(_f=(_e=this.trafficRoutingConfig)===null||_e===void 0?void 0:_e.timeBasedCanary)===null||_f===void 0?void 0:_f.bakeTimeMins}),TimeBasedLinear:util_1.undefinedIfAllValuesAreEmpty({StepPercentage:(_h=(_g=this.trafficRoutingConfig)===null||_g===void 0?void 0:_g.timeBasedLinear)===null||_h===void 0?void 0:_h.stepPercentage,BakeTimeMins:(_k=(_j=this.trafficRoutingConfig)===null||_j===void 0?void 0:_j.timeBasedLinear)===null||_k===void 0?void 0:_k.bakeTimeMins})}),AdditionalOptions:util_1.undefinedIfAllValuesAreEmpty({TerminationWaitTimeInMinutes:(_l=this.additionalOptions)===null||_l===void 0?void 0:_l.terminationWaitTimeInMinutes}),LifecycleEventHooks:util_1.undefinedIfAllValuesAreEmpty({BeforeInstall:(_m=this.lifecycleEventHooks)===null||_m===void 0?void 0:_m.beforeInstall,AfterInstall:(_o=this.lifecycleEventHooks)===null||_o===void 0?void 0:_o.afterInstall,AfterAllowTestTraffic:(_p=this.lifecycleEventHooks)===null||_p===void 0?void 0:_p.afterAllowTestTraffic,BeforeAllowTraffic:(_q=this.lifecycleEventHooks)===null||_q===void 0?void 0:_q.beforeAllowTraffic,AfterAllowTraffic:(_r=this.lifecycleEventHooks)===null||_r===void 0?void 0:_r.afterAllowTraffic})}}}exports.CfnCodeDeployBlueGreenHook=CfnCodeDeployBlueGreenHook,_a=JSII_RTTI_SYMBOL_1,CfnCodeDeployBlueGreenHook[_a]={fqn:"aws-cdk-lib.CfnCodeDeployBlueGreenHook",version:"2.20.0"};
//# sourceMappingURL=cfn-codedeploy-blue-green-hook.js.map
