{
  "version": 3,
  "sources": ["sqs.ts"],
  "sourcesContent": ["import * as lambda from '../../aws-lambda';\nimport * as sqs from '../../aws-sqs';\nimport { Duration, Names, Token } from '../../core';\n\nexport interface SqsEventSourceProps {\n  /**\n   * The largest number of records that AWS Lambda will retrieve from your event\n   * source at the time of invoking your function. Your function receives an\n   * event with all the retrieved records.\n   *\n   * Valid Range: Minimum value of 1. Maximum value of 10.\n   * If `maxBatchingWindow` is configured, this value can go up to 10,000.\n   *\n   * @default 10\n   */\n  readonly batchSize?: number;\n\n  /**\n   * The maximum amount of time to gather records before invoking the function.\n   *\n   * Valid Range: Minimum value of 0 minutes. Maximum value of 5 minutes.\n   *\n   * @default - no batching window. The lambda function will be invoked immediately with the records that are available.\n   */\n  readonly maxBatchingWindow?: Duration;\n\n  /**\n   * Allow functions to return partially successful responses for a batch of records.\n   *\n   * @see https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html#services-sqs-batchfailurereporting\n   *\n   * @default false\n   */\n  readonly reportBatchItemFailures?: boolean;\n\n  /**\n   * If the SQS event source mapping should be enabled.\n   *\n   * @default true\n   */\n  readonly enabled?: boolean;\n}\n\n/**\n * Use an Amazon SQS queue as an event source for AWS Lambda.\n */\nexport class SqsEventSource implements lambda.IEventSource {\n  private _eventSourceMappingId?: string = undefined;\n\n  constructor(readonly queue: sqs.IQueue, private readonly props: SqsEventSourceProps = { }) {\n    if (this.props.maxBatchingWindow !== undefined) {\n      if (queue.fifo) {\n        throw new Error('Batching window is not supported for FIFO queues');\n      }\n      if (!this.props.maxBatchingWindow.isUnresolved() && this.props.maxBatchingWindow.toSeconds() > 300) {\n        throw new Error(`Maximum batching window must be 300 seconds or less (given ${this.props.maxBatchingWindow.toHumanString()})`);\n      }\n    }\n    if (this.props.batchSize !== undefined && !Token.isUnresolved(this.props.batchSize)) {\n      if (this.props.maxBatchingWindow !== undefined && (this.props.batchSize < 1 || this.props.batchSize > 10000)) {\n        throw new Error(`Maximum batch size must be between 1 and 10000 inclusive (given ${this.props.batchSize}) when batching window is specified.`);\n      }\n      if (this.props.maxBatchingWindow === undefined && (this.props.batchSize < 1 || this.props.batchSize > 10)) {\n        throw new Error(`Maximum batch size must be between 1 and 10 inclusive (given ${this.props.batchSize}) when batching window is not specified.`);\n      }\n    }\n  }\n\n  public bind(target: lambda.IFunction) {\n    const eventSourceMapping = target.addEventSourceMapping(`SqsEventSource:${Names.nodeUniqueId(this.queue.node)}`, {\n      batchSize: this.props.batchSize,\n      maxBatchingWindow: this.props.maxBatchingWindow,\n      reportBatchItemFailures: this.props.reportBatchItemFailures,\n      enabled: this.props.enabled,\n      eventSourceArn: this.queue.queueArn,\n    });\n    this._eventSourceMappingId = eventSourceMapping.eventSourceMappingId;\n\n    this.queue.grantConsumeMessages(target);\n  }\n\n  /**\n   * The identifier for this EventSourceMapping\n   */\n  public get eventSourceMappingId(): string {\n    if (!this._eventSourceMappingId) {\n      throw new Error('SqsEventSource is not yet bound to an event source mapping');\n    }\n    return this._eventSourceMappingId;\n  }\n}\n"],
  "mappings": "qNAEA,OAAA,QAAA,YAAA,EA4CA,MAAa,cAAc,CAGzB,YAAqB,MAAoC,MAA6B,CAAA,EAAG,CACvF,GADmB,KAAA,MAAA,MAAoC,KAAA,MAAA,MAFjD,KAAA,sBAAiC,yJAGnC,KAAK,MAAM,oBAAsB,OAAW,CAC9C,GAAI,MAAM,KACR,KAAM,IAAI,OAAM,kDAAkD,EAEpE,GAAI,CAAC,KAAK,MAAM,kBAAkB,aAAY,GAAM,KAAK,MAAM,kBAAkB,UAAS,EAAK,IAC7F,KAAM,IAAI,OAAM,8DAA8D,KAAK,MAAM,kBAAkB,cAAa,IAAK,EAGjI,GAAI,KAAK,MAAM,YAAc,QAAa,CAAC,OAAA,MAAM,aAAa,KAAK,MAAM,SAAS,EAAG,CACnF,GAAI,KAAK,MAAM,oBAAsB,QAAc,MAAK,MAAM,UAAY,GAAK,KAAK,MAAM,UAAY,KACpG,KAAM,IAAI,OAAM,mEAAmE,KAAK,MAAM,+CAA+C,EAE/I,GAAI,KAAK,MAAM,oBAAsB,QAAc,MAAK,MAAM,UAAY,GAAK,KAAK,MAAM,UAAY,IACpG,KAAM,IAAI,OAAM,gEAAgE,KAAK,MAAM,mDAAmD,GAK7I,KAAK,OAAwB,kEAClC,KAAM,oBAAqB,OAAO,sBAAsB,kBAAkB,OAAA,MAAM,aAAa,KAAK,MAAM,IAAI,IAAK,CAC/G,UAAW,KAAK,MAAM,UACtB,kBAAmB,KAAK,MAAM,kBAC9B,wBAAyB,KAAK,MAAM,wBACpC,QAAS,KAAK,MAAM,QACpB,eAAgB,KAAK,MAAM,SAC5B,EACD,KAAK,sBAAwB,mBAAmB,qBAEhD,KAAK,MAAM,qBAAqB,MAAM,KAM7B,uBAAoB,CAC7B,GAAI,CAAC,KAAK,sBACR,KAAM,IAAI,OAAM,4DAA4D,EAE9E,MAAO,MAAK,uBA1ChB,QAAA,eAAA",
  "names": []
}
