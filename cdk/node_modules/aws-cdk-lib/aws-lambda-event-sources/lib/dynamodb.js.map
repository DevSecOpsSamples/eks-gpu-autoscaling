{
  "version": 3,
  "sources": ["dynamodb.ts"],
  "sourcesContent": ["import * as dynamodb from '../../aws-dynamodb';\nimport * as lambda from '../../aws-lambda';\nimport { Names, Token } from '../../core';\nimport { StreamEventSource, StreamEventSourceProps } from './stream';\n\nexport interface DynamoEventSourceProps extends StreamEventSourceProps {\n}\n\n/**\n * Use an Amazon DynamoDB stream as an event source for AWS Lambda.\n */\nexport class DynamoEventSource extends StreamEventSource {\n  private _eventSourceMappingId?: string = undefined;\n\n  constructor(private readonly table: dynamodb.ITable, props: DynamoEventSourceProps) {\n    super(props);\n\n    if (this.props.batchSize !== undefined\n      && !Token.isUnresolved(this.props.batchSize)\n      && (this.props.batchSize < 1 || this.props.batchSize > 10000)) {\n      throw new Error(`Maximum batch size must be between 1 and 10000 inclusive (given ${this.props.batchSize})`);\n    }\n  }\n\n  public bind(target: lambda.IFunction) {\n    if (!this.table.tableStreamArn) {\n      throw new Error(`DynamoDB Streams must be enabled on the table ${this.table.node.path}`);\n    }\n\n    const eventSourceMapping = target.addEventSourceMapping(`DynamoDBEventSource:${Names.nodeUniqueId(this.table.node)}`,\n      this.enrichMappingOptions({ eventSourceArn: this.table.tableStreamArn }),\n    );\n    this._eventSourceMappingId = eventSourceMapping.eventSourceMappingId;\n\n    this.table.grantStreamRead(target);\n  }\n\n  /**\n   * The identifier for this EventSourceMapping\n   */\n  public get eventSourceMappingId(): string {\n    if (!this._eventSourceMappingId) {\n      throw new Error('DynamoEventSource is not yet bound to an event source mapping');\n    }\n    return this._eventSourceMappingId;\n  }\n}\n"],
  "mappings": "wNAEA,OAAA,QAAA,YAAA,EACA,SAAA,QAAA,UAAA,EAQA,MAAa,yBAA0B,UAAA,iBAAiB,CAGtD,YAA6B,MAAwB,MAA6B,CAChF,MAAM,KAAK,EAEX,GAH2B,KAAA,MAAA,MAFrB,KAAA,sBAAiC,iKAKnC,KAAK,MAAM,YAAc,QACxB,CAAC,OAAA,MAAM,aAAa,KAAK,MAAM,SAAS,GACvC,MAAK,MAAM,UAAY,GAAK,KAAK,MAAM,UAAY,KACvD,KAAM,IAAI,OAAM,mEAAmE,KAAK,MAAM,YAAY,EAIvG,KAAK,OAAwB,CAClC,oEAAI,CAAC,KAAK,MAAM,eACd,KAAM,IAAI,OAAM,iDAAiD,KAAK,MAAM,KAAK,MAAM,EAGzF,KAAM,oBAAqB,OAAO,sBAAsB,uBAAuB,OAAA,MAAM,aAAa,KAAK,MAAM,IAAI,IAC/G,KAAK,qBAAqB,CAAE,eAAgB,KAAK,MAAM,cAAc,CAAE,CAAC,EAE1E,KAAK,sBAAwB,mBAAmB,qBAEhD,KAAK,MAAM,gBAAgB,MAAM,KAMxB,uBAAoB,CAC7B,GAAI,CAAC,KAAK,sBACR,KAAM,IAAI,OAAM,+DAA+D,EAEjF,MAAO,MAAK,uBAjChB,QAAA,kBAAA",
  "names": []
}
