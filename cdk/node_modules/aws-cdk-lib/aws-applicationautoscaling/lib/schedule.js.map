{
  "version": 3,
  "sources": ["schedule.ts"],
  "sourcesContent": ["import { Annotations, Duration } from '../../core';\nimport { Construct } from 'constructs';\n\n/**\n * Schedule for scheduled scaling actions\n */\nexport abstract class Schedule {\n  /**\n   * Construct a schedule from a literal schedule expression\n   *\n   * @param expression The expression to use. Must be in a format that Application AutoScaling will recognize\n   */\n  public static expression(expression: string): Schedule {\n    return new LiteralSchedule(expression);\n  }\n\n  /**\n   * Construct a schedule from an interval and a time unit\n   */\n  public static rate(duration: Duration): Schedule {\n    if (duration.isUnresolved()) {\n      const validDurationUnit = ['minute', 'minutes', 'hour', 'hours', 'day', 'days'];\n      if (!validDurationUnit.includes(duration.unitLabel())) {\n        throw new Error(\"Allowed units for scheduling are: 'minute', 'minutes', 'hour', 'hours', 'day' or 'days'\");\n      }\n      return new LiteralSchedule(`rate(${duration.formatTokenToNumber()})`);\n    }\n    if (duration.toSeconds() === 0) {\n      throw new Error('Duration cannot be 0');\n    }\n\n    let rate = maybeRate(duration.toDays({ integral: false }), 'day');\n    if (rate === undefined) { rate = maybeRate(duration.toHours({ integral: false }), 'hour'); }\n    if (rate === undefined) { rate = makeRate(duration.toMinutes({ integral: true }), 'minute'); }\n    return new LiteralSchedule(rate);\n  }\n\n  /**\n   * Construct a Schedule from a moment in time\n   */\n  public static at(moment: Date): Schedule {\n    return new LiteralSchedule(`at(${formatISO(moment)})`);\n  }\n\n  /**\n   * Create a schedule from a set of cron fields\n   */\n  public static cron(options: CronOptions): Schedule {\n    if (options.weekDay !== undefined && options.day !== undefined) {\n      throw new Error('Cannot supply both \\'day\\' and \\'weekDay\\', use at most one');\n    }\n\n    const minute = fallback(options.minute, '*');\n    const hour = fallback(options.hour, '*');\n    const month = fallback(options.month, '*');\n    const year = fallback(options.year, '*');\n\n    // Weekday defaults to '?' if not supplied. If it is supplied, day must become '?'\n    const day = fallback(options.day, options.weekDay !== undefined ? '?' : '*');\n    const weekDay = fallback(options.weekDay, '?');\n\n    return new class extends Schedule {\n      public readonly expressionString: string = `cron(${minute} ${hour} ${day} ${month} ${weekDay} ${year})`;\n      public _bind(scope: Construct) {\n        if (!options.minute) {\n          Annotations.of(scope).addWarning('cron: If you don\\'t pass \\'minute\\', by default the event runs every minute. Pass \\'minute: \\'*\\'\\' if that\\'s what you intend, or \\'minute: 0\\' to run once per hour instead.');\n        }\n        return new LiteralSchedule(this.expressionString);\n      }\n    };\n  }\n\n  /**\n   * Retrieve the expression for this schedule\n   */\n  public abstract readonly expressionString: string;\n\n  protected constructor() {}\n\n  /**\n   *\n   * @internal\n   */\n  public abstract _bind(scope: Construct): void;\n}\n\n/**\n * Options to configure a cron expression\n *\n * All fields are strings so you can use complex expressions. Absence of\n * a field implies '*' or '?', whichever one is appropriate.\n *\n * @see https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html#CronExpressions\n */\nexport interface CronOptions {\n  /**\n   * The minute to run this rule at\n   *\n   * @default - Every minute\n   */\n  readonly minute?: string;\n\n  /**\n   * The hour to run this rule at\n   *\n   * @default - Every hour\n   */\n  readonly hour?: string;\n\n  /**\n   * The day of the month to run this rule at\n   *\n   * @default - Every day of the month\n   */\n  readonly day?: string;\n\n  /**\n   * The month to run this rule at\n   *\n   * @default - Every month\n   */\n  readonly month?: string;\n\n  /**\n   * The year to run this rule at\n   *\n   * @default - Every year\n   */\n  readonly year?: string;\n\n  /**\n   * The day of the week to run this rule at\n   *\n   * @default - Any day of the week\n   */\n  readonly weekDay?: string;\n}\n\nclass LiteralSchedule extends Schedule {\n  constructor(public readonly expressionString: string) {\n    super();\n  }\n\n  public _bind() {}\n}\n\nfunction fallback<T>(x: T | undefined, def: T): T {\n  return x === undefined ? def : x;\n}\n\nfunction formatISO(date?: Date) {\n  if (!date) { return undefined; }\n\n  return date.getUTCFullYear() +\n    '-' + pad(date.getUTCMonth() + 1) +\n    '-' + pad(date.getUTCDate()) +\n    'T' + pad(date.getUTCHours()) +\n    ':' + pad(date.getUTCMinutes()) +\n    ':' + pad(date.getUTCSeconds());\n\n  function pad(num: number) {\n    if (num < 10) {\n      return '0' + num;\n    }\n    return num;\n  }\n}\n\n/**\n * Return the rate if the rate is whole number\n */\nfunction maybeRate(interval: number, singular: string) {\n  if (interval === 0 || !Number.isInteger(interval)) { return undefined; }\n  return makeRate(interval, singular);\n}\n\n/**\n * Return 'rate(${interval} ${singular}(s))` for the interval\n */\nfunction makeRate(interval: number, singular: string) {\n  return interval === 1 ? `rate(1 ${singular})` : `rate(${interval} ${singular}s)`;\n}\n"],
  "mappings": "+MAAA,OAAA,QAAA,YAAA,EAMA,MAAsB,QAAQ,CAuE5B,aAAA,CAAA,OAjEc,YAAW,WAAkB,CACzC,MAAO,IAAI,iBAAgB,UAAU,QAMzB,MAAK,SAAkB,CACnC,0DAAI,SAAS,aAAY,EAAI,CAE3B,GAAI,CAAC,AADqB,CAAC,SAAU,UAAW,OAAQ,QAAS,MAAO,MAAM,EACvD,SAAS,SAAS,UAAS,CAAE,EAClD,KAAM,IAAI,OAAM,yFAAyF,EAE3G,MAAO,IAAI,iBAAgB,QAAQ,SAAS,oBAAmB,IAAK,EAEtE,GAAI,SAAS,UAAS,IAAO,EAC3B,KAAM,IAAI,OAAM,sBAAsB,EAGxC,GAAI,MAAO,UAAU,SAAS,OAAO,CAAE,SAAU,EAAK,CAAE,EAAG,KAAK,EAChE,MAAI,QAAS,QAAa,MAAO,UAAU,SAAS,QAAQ,CAAE,SAAU,EAAK,CAAE,EAAG,MAAM,GACpF,OAAS,QAAa,MAAO,SAAS,SAAS,UAAU,CAAE,SAAU,EAAI,CAAE,EAAG,QAAQ,GACnF,GAAI,iBAAgB,IAAI,QAMnB,IAAG,OAAY,CAC3B,MAAO,IAAI,iBAAgB,MAAM,UAAU,MAAM,IAAI,QAMzC,MAAK,QAAoB,CACrC,uFAAI,QAAQ,UAAY,QAAa,QAAQ,MAAQ,OACnD,KAAM,IAAI,OAAM,yDAA6D,EAG/E,KAAM,QAAS,SAAS,QAAQ,OAAQ,GAAG,EACrC,KAAO,SAAS,QAAQ,KAAM,GAAG,EACjC,MAAQ,SAAS,QAAQ,MAAO,GAAG,EACnC,KAAO,SAAS,QAAQ,KAAM,GAAG,EAGjC,IAAM,SAAS,QAAQ,IAAK,QAAQ,UAAY,OAAY,IAAM,GAAG,EACrE,QAAU,SAAS,QAAQ,QAAS,GAAG,EAE7C,MAAO,IAAI,cAAc,SAAQ,CAAtB,aAAA,qBACO,KAAA,iBAA2B,QAAQ,UAAU,QAAQ,OAAO,SAAS,WAAW,OAOlG,CANS,MAAM,MAAgB,CAC3B,MAAK,SAAQ,QACX,OAAA,YAAY,GAAG,KAAK,EAAE,WAAW,sKAAgL,EAE5M,GAAI,iBAAgB,KAAK,gBAAgB,CAClD,IA9DN,QAAA,SAAA,qHAoIA,MAAM,uBAAwB,SAAQ,CACpC,YAA4B,iBAAwB,CAClD,MAAK,EADqB,KAAA,iBAAA,iBAIrB,OAAK,CAAA,EAGd,kBAAqB,EAAkB,IAAM,CAC3C,MAAO,KAAM,OAAY,IAAM,CACjC,CAEA,mBAAmB,KAAW,CAC5B,GAAI,CAAC,KAAQ,OAEb,MAAO,MAAK,eAAc,EACxB,IAAM,IAAI,KAAK,YAAW,EAAK,CAAC,EAChC,IAAM,IAAI,KAAK,WAAU,CAAE,EAC3B,IAAM,IAAI,KAAK,YAAW,CAAE,EAC5B,IAAM,IAAI,KAAK,cAAa,CAAE,EAC9B,IAAM,IAAI,KAAK,cAAa,CAAE,EAEhC,aAAa,IAAW,CACtB,MAAI,KAAM,GACD,IAAM,IAER,GACT,CACF,CAKA,mBAAmB,SAAkB,SAAgB,CACnD,GAAI,aAAa,GAAK,CAAC,OAAO,UAAU,QAAQ,GAChD,MAAO,UAAS,SAAU,QAAQ,CACpC,CAKA,kBAAkB,SAAkB,SAAgB,CAClD,MAAO,YAAa,EAAI,UAAU,YAAc,QAAQ,YAAY,YACtE",
  "names": []
}
