{
  "version": 3,
  "sources": ["access-point.ts"],
  "sourcesContent": ["import { ArnFormat, IResource, Resource, Stack } from '../../core';\nimport { Construct } from 'constructs';\nimport { IFileSystem } from './efs-file-system';\nimport { CfnAccessPoint } from './efs.generated';\n\n/**\n * Represents an EFS AccessPoint\n */\nexport interface IAccessPoint extends IResource {\n  /**\n   * The ID of the AccessPoint\n   *\n   * @attribute\n   */\n  readonly accessPointId: string;\n\n  /**\n   * The ARN of the AccessPoint\n   *\n   * @attribute\n   */\n  readonly accessPointArn: string;\n\n  /**\n   * The EFS file system\n   */\n  readonly fileSystem: IFileSystem;\n}\n\n/**\n * Permissions as POSIX ACL\n*/\nexport interface Acl {\n  /**\n   * Specifies the POSIX user ID to apply to the RootDirectory. Accepts values from 0 to 2^32 (4294967295).\n   */\n  readonly ownerUid: string;\n\n  /**\n   * Specifies the POSIX group ID to apply to the RootDirectory. Accepts values from 0 to 2^32 (4294967295).\n   */\n  readonly ownerGid: string;\n\n  /**\n   * Specifies the POSIX permissions to apply to the RootDirectory, in the format of an octal number representing\n   * the file's mode bits.\n   */\n  readonly permissions: string;\n}\n\n/**\n * Represents the PosixUser\n */\nexport interface PosixUser {\n  /**\n   * The POSIX user ID used for all file system operations using this access point.\n   */\n  readonly uid: string;\n\n  /**\n   * The POSIX group ID used for all file system operations using this access point.\n   */\n  readonly gid: string;\n\n  /**\n   * Secondary POSIX group IDs used for all file system operations using this access point.\n   *\n   * @default - None\n   */\n  readonly secondaryGids?: string[];\n}\n\n/**\n * Options to create an AccessPoint\n */\nexport interface AccessPointOptions {\n  /**\n   * Specifies the POSIX IDs and permissions to apply when creating the access point's root directory. If the\n   * root directory specified by `path` does not exist, EFS creates the root directory and applies the\n   * permissions specified here. If the specified `path` does not exist, you must specify `createAcl`.\n   *\n   * @default - None. The directory specified by `path` must exist.\n   */\n  readonly createAcl?: Acl;\n\n  /**\n   * Specifies the path on the EFS file system to expose as the root directory to NFS clients using the access point\n   * to access the EFS file system\n   *\n   * @default '/'\n   */\n  readonly path?: string;\n\n  /**\n   * The full POSIX identity, including the user ID, group ID, and any secondary group IDs, on the access point\n   * that is used for all file system operations performed by NFS clients using the access point.\n   *\n   * Specify this to enforce a user identity using an access point.\n   *\n   * @see - [Enforcing a User Identity Using an Access Point](https://docs.aws.amazon.com/efs/latest/ug/efs-access-points.html)\n   *\n   * @default - user identity not enforced\n   */\n  readonly posixUser?: PosixUser;\n}\n\n/**\n * Properties for the AccessPoint\n */\nexport interface AccessPointProps extends AccessPointOptions {\n  /**\n   * The efs filesystem\n   */\n  readonly fileSystem: IFileSystem;\n}\n\n/**\n * Attributes that can be specified when importing an AccessPoint\n */\nexport interface AccessPointAttributes {\n  /**\n   * The ID of the AccessPoint\n   * One of this, or {@link accessPointArn} is required\n   *\n   * @default - determined based on accessPointArn\n   */\n  readonly accessPointId?: string;\n\n  /**\n   * The ARN of the AccessPoint\n   * One of this, or {@link accessPointId} is required\n   *\n   * @default - determined based on accessPointId\n   */\n  readonly accessPointArn?: string;\n\n  /**\n   * The EFS file system\n   *\n   * @default - no EFS file system\n   */\n  readonly fileSystem?: IFileSystem;\n}\n\nabstract class AccessPointBase extends Resource implements IAccessPoint {\n  /**\n   * The ARN of the Access Point\n   * @attribute\n   */\n  public abstract readonly accessPointArn: string;\n\n  /**\n   * The ID of the Access Point\n   * @attribute\n   */\n  public abstract readonly accessPointId: string;\n\n  /**\n   * The file system of the access point\n   */\n  public abstract readonly fileSystem: IFileSystem;\n}\n\n/**\n * Represents the AccessPoint\n */\nexport class AccessPoint extends AccessPointBase {\n  /**\n   * Import an existing Access Point by attributes\n   */\n  public static fromAccessPointAttributes(scope: Construct, id: string, attrs: AccessPointAttributes): IAccessPoint {\n    return new ImportedAccessPoint(scope, id, attrs);\n  }\n\n  /**\n   * Import an existing Access Point by id\n   */\n  public static fromAccessPointId(scope: Construct, id: string, accessPointId: string): IAccessPoint {\n    return new ImportedAccessPoint(scope, id, {\n      accessPointId: accessPointId,\n    });\n  }\n\n  /**\n   * The ARN of the Access Point\n   * @attribute\n   */\n  public readonly accessPointArn: string;\n\n  /**\n   * The ID of the Access Point\n   * @attribute\n   */\n  public readonly accessPointId: string;\n\n  /**\n   * The file system of the access point\n   */\n  public readonly fileSystem: IFileSystem;\n\n  constructor(scope: Construct, id: string, props: AccessPointProps) {\n    super(scope, id);\n\n    const resource = new CfnAccessPoint(this, 'Resource', {\n      fileSystemId: props.fileSystem.fileSystemId,\n      rootDirectory: {\n        creationInfo: props.createAcl ? {\n          ownerGid: props.createAcl.ownerGid,\n          ownerUid: props.createAcl.ownerUid,\n          permissions: props.createAcl.permissions,\n        } : undefined,\n        path: props.path,\n      },\n      posixUser: props.posixUser ? {\n        uid: props.posixUser.uid,\n        gid: props.posixUser.gid,\n        secondaryGids: props.posixUser.secondaryGids,\n      } : undefined,\n    });\n\n    this.accessPointId = resource.ref;\n    this.accessPointArn = Stack.of(scope).formatArn({\n      service: 'elasticfilesystem',\n      resource: 'access-point',\n      resourceName: this.accessPointId,\n    });\n    this.fileSystem = props.fileSystem;\n  }\n}\n\nclass ImportedAccessPoint extends AccessPointBase {\n  public readonly accessPointId: string;\n  public readonly accessPointArn: string;\n  private readonly _fileSystem?: IFileSystem;\n\n  constructor(scope: Construct, id: string, attrs: AccessPointAttributes) {\n    super(scope, id);\n\n    if (!attrs.accessPointId) {\n      if (!attrs.accessPointArn) {\n        throw new Error('One of accessPointId or AccessPointArn is required!');\n      }\n\n      this.accessPointArn = attrs.accessPointArn;\n      let maybeApId = Stack.of(scope).splitArn(attrs.accessPointArn, ArnFormat.SLASH_RESOURCE_NAME).resourceName;\n\n      if (!maybeApId) {\n        throw new Error('ARN for AccessPoint must provide the resource name.');\n      }\n\n      this.accessPointId = maybeApId;\n    } else {\n      if (attrs.accessPointArn) {\n        throw new Error('Only one of accessPointId or AccessPointArn can be provided!');\n      }\n\n      this.accessPointId = attrs.accessPointId;\n      this.accessPointArn = Stack.of(scope).formatArn({\n        service: 'elasticfilesystem',\n        resource: 'access-point',\n        resourceName: attrs.accessPointId,\n      });\n    }\n\n    this._fileSystem = attrs.fileSystem;\n  }\n\n  public get fileSystem() {\n    if (!this._fileSystem) {\n      throw new Error(\"fileSystem is only available if 'fromAccessPointAttributes()' is used and a fileSystem is passed in as an attribute.\");\n    }\n\n    return this._fileSystem;\n  }\n}\n"],
  "mappings": "kNAAA,OAAA,QAAA,YAAA,EAGA,gBAAA,QAAA,iBAAA,EA6IA,MAAe,uBAAwB,QAAA,QAAQ,EAsB/C,MAAa,mBAAoB,gBAAe,CAkC9C,YAAY,MAAkB,GAAY,MAAuB,CAC/D,MAAM,MAAO,EAAE,sEAEf,KAAM,UAAW,GAAI,iBAAA,eAAe,KAAM,WAAY,CACpD,aAAc,MAAM,WAAW,aAC/B,cAAe,CACb,aAAc,MAAM,UAAY,CAC9B,SAAU,MAAM,UAAU,SAC1B,SAAU,MAAM,UAAU,SAC1B,YAAa,MAAM,UAAU,aAC3B,OACJ,KAAM,MAAM,MAEd,UAAW,MAAM,UAAY,CAC3B,IAAK,MAAM,UAAU,IACrB,IAAK,MAAM,UAAU,IACrB,cAAe,MAAM,UAAU,eAC7B,OACL,EAED,KAAK,cAAgB,SAAS,IAC9B,KAAK,eAAiB,OAAA,MAAM,GAAG,KAAK,EAAE,UAAU,CAC9C,QAAS,oBACT,SAAU,eACV,aAAc,KAAK,cACpB,EACD,KAAK,WAAa,MAAM,iBAxDZ,2BAA0B,MAAkB,GAAY,MAA4B,iFACzF,GAAI,qBAAoB,MAAO,GAAI,KAAK,QAMnC,mBAAkB,MAAkB,GAAY,cAAqB,CACjF,MAAO,IAAI,qBAAoB,MAAO,GAAI,CACxC,cACD,GAdL,QAAA,YAAA,2GAgEA,MAAM,2BAA4B,gBAAe,CAK/C,YAAY,MAAkB,GAAY,MAA4B,CACpE,MAAM,MAAO,EAAE,EAEf,GAAK,MAAM,cAaJ,CACL,GAAI,MAAM,eACR,KAAM,IAAI,OAAM,8DAA8D,EAGhF,KAAK,cAAgB,MAAM,cAC3B,KAAK,eAAiB,OAAA,MAAM,GAAG,KAAK,EAAE,UAAU,CAC9C,QAAS,oBACT,SAAU,eACV,aAAc,MAAM,cACrB,MAvBuB,CACxB,GAAI,CAAC,MAAM,eACT,KAAM,IAAI,OAAM,qDAAqD,EAGvE,KAAK,eAAiB,MAAM,eAC5B,GAAI,WAAY,OAAA,MAAM,GAAG,KAAK,EAAE,SAAS,MAAM,eAAgB,OAAA,UAAU,mBAAmB,EAAE,aAE9F,GAAI,CAAC,UACH,KAAM,IAAI,OAAM,qDAAqD,EAGvE,KAAK,cAAgB,UAcvB,KAAK,YAAc,MAAM,cAGhB,aAAU,CACnB,GAAI,CAAC,KAAK,YACR,KAAM,IAAI,OAAM,sHAAsH,EAGxI,MAAO,MAAK",
  "names": []
}
