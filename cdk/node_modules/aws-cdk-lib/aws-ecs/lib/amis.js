"use strict";var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.BottleRocketImage=exports.BottlerocketEcsVariant=exports.EcsOptimizedImage=exports.EcsOptimizedAmi=exports.WindowsOptimizedVersion=exports.AmiHardwareType=void 0;const jsiiDeprecationWarnings=require("../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),ec2=require("../../aws-ec2"),ssm=require("../../aws-ssm");var AmiHardwareType;(function(AmiHardwareType2){AmiHardwareType2.STANDARD="Standard",AmiHardwareType2.GPU="GPU",AmiHardwareType2.ARM="ARM64"})(AmiHardwareType=exports.AmiHardwareType||(exports.AmiHardwareType={}));var WindowsOptimizedVersion;(function(WindowsOptimizedVersion2){WindowsOptimizedVersion2.SERVER_2019="2019",WindowsOptimizedVersion2.SERVER_2016="2016"})(WindowsOptimizedVersion=exports.WindowsOptimizedVersion||(exports.WindowsOptimizedVersion={}));class EcsOptimizedAmi{constructor(props){var _d;if(this.hwType=props&&props.hardwareType||AmiHardwareType.STANDARD,props&&props.generation){if(props.generation===ec2.AmazonLinuxGeneration.AMAZON_LINUX&&this.hwType!==AmiHardwareType.STANDARD)throw new Error("Amazon Linux does not support special hardware type. Use Amazon Linux 2 instead");if(props.windowsVersion)throw new Error('"windowsVersion" and Linux image "generation" cannot be both set');this.generation=props.generation}else if(props&&props.windowsVersion){if(this.hwType!==AmiHardwareType.STANDARD)throw new Error("Windows Server does not support special hardware type");this.windowsVersion=props.windowsVersion}else this.generation=ec2.AmazonLinuxGeneration.AMAZON_LINUX_2;this.amiParameterName="/aws/service/ecs/optimized-ami/"+(this.generation===ec2.AmazonLinuxGeneration.AMAZON_LINUX?"amazon-linux/":"")+(this.generation===ec2.AmazonLinuxGeneration.AMAZON_LINUX_2?"amazon-linux-2/":"")+(this.windowsVersion?`windows_server/${this.windowsVersion}/english/full/`:"")+(this.hwType===AmiHardwareType.GPU?"gpu/":"")+(this.hwType===AmiHardwareType.ARM?"arm64/":"")+"recommended/image_id",this.cachedInContext=(_d=props==null?void 0:props.cachedInContext)!==null&&_d!==void 0?_d:!1}getImage(scope){const ami=lookupImage(scope,this.cachedInContext,this.amiParameterName),osType=this.windowsVersion?ec2.OperatingSystemType.WINDOWS:ec2.OperatingSystemType.LINUX;return{imageId:ami,osType,userData:ec2.UserData.forOperatingSystem(osType)}}}exports.EcsOptimizedAmi=EcsOptimizedAmi,_a=JSII_RTTI_SYMBOL_1,EcsOptimizedAmi[_a]={fqn:"aws-cdk-lib.aws_ecs.EcsOptimizedAmi",version:"2.20.0"};class EcsOptimizedImage{constructor(props){var _d;if(this.hwType=props&&props.hardwareType,props.windowsVersion)this.windowsVersion=props.windowsVersion;else if(props.generation)this.generation=props.generation;else throw new Error("This error should never be thrown");this.amiParameterName="/aws/service/ecs/optimized-ami/"+(this.generation===ec2.AmazonLinuxGeneration.AMAZON_LINUX?"amazon-linux/":"")+(this.generation===ec2.AmazonLinuxGeneration.AMAZON_LINUX_2?"amazon-linux-2/":"")+(this.windowsVersion?`windows_server/${this.windowsVersion}/english/full/`:"")+(this.hwType===AmiHardwareType.GPU?"gpu/":"")+(this.hwType===AmiHardwareType.ARM?"arm64/":"")+"recommended/image_id",this.cachedInContext=(_d=props==null?void 0:props.cachedInContext)!==null&&_d!==void 0?_d:!1}static amazonLinux2(hardwareType=AmiHardwareType.STANDARD,options={}){return jsiiDeprecationWarnings.aws_cdk_lib_aws_ecs_AmiHardwareType(hardwareType),jsiiDeprecationWarnings.aws_cdk_lib_aws_ecs_EcsOptimizedImageOptions(options),new EcsOptimizedImage({generation:ec2.AmazonLinuxGeneration.AMAZON_LINUX_2,hardwareType,cachedInContext:options.cachedInContext})}static amazonLinux(options={}){return jsiiDeprecationWarnings.aws_cdk_lib_aws_ecs_EcsOptimizedImageOptions(options),new EcsOptimizedImage({generation:ec2.AmazonLinuxGeneration.AMAZON_LINUX,cachedInContext:options.cachedInContext})}static windows(windowsVersion,options={}){return jsiiDeprecationWarnings.aws_cdk_lib_aws_ecs_WindowsOptimizedVersion(windowsVersion),jsiiDeprecationWarnings.aws_cdk_lib_aws_ecs_EcsOptimizedImageOptions(options),new EcsOptimizedImage({windowsVersion,cachedInContext:options.cachedInContext})}getImage(scope){const ami=lookupImage(scope,this.cachedInContext,this.amiParameterName),osType=this.windowsVersion?ec2.OperatingSystemType.WINDOWS:ec2.OperatingSystemType.LINUX;return{imageId:ami,osType,userData:ec2.UserData.forOperatingSystem(osType)}}}exports.EcsOptimizedImage=EcsOptimizedImage,_b=JSII_RTTI_SYMBOL_1,EcsOptimizedImage[_b]={fqn:"aws-cdk-lib.aws_ecs.EcsOptimizedImage",version:"2.20.0"};var BottlerocketEcsVariant;(function(BottlerocketEcsVariant2){BottlerocketEcsVariant2.AWS_ECS_1="aws-ecs-1"})(BottlerocketEcsVariant=exports.BottlerocketEcsVariant||(exports.BottlerocketEcsVariant={}));class BottleRocketImage{constructor(props={}){var _d,_e,_f;jsiiDeprecationWarnings.aws_cdk_lib_aws_ecs_BottleRocketImageProps(props),this.variant=(_d=props.variant)!==null&&_d!==void 0?_d:BottlerocketEcsVariant.AWS_ECS_1,this.architecture=(_e=props.architecture)!==null&&_e!==void 0?_e:ec2.InstanceArchitecture.X86_64,this.amiParameterName=`/aws/service/bottlerocket/${this.variant}/${this.architecture}/latest/image_id`,this.cachedInContext=(_f=props.cachedInContext)!==null&&_f!==void 0?_f:!1}getImage(scope){return{imageId:lookupImage(scope,this.cachedInContext,this.amiParameterName),osType:ec2.OperatingSystemType.LINUX,userData:ec2.UserData.custom("")}}}exports.BottleRocketImage=BottleRocketImage,_c=JSII_RTTI_SYMBOL_1,BottleRocketImage[_c]={fqn:"aws-cdk-lib.aws_ecs.BottleRocketImage",version:"2.20.0"};function lookupImage(scope,cachedInContext,parameterName){return cachedInContext?ssm.StringParameter.valueFromLookup(scope,parameterName):ssm.StringParameter.valueForTypedStringParameter(scope,parameterName,ssm.ParameterType.AWS_EC2_IMAGE_ID)}
//# sourceMappingURL=amis.js.map
