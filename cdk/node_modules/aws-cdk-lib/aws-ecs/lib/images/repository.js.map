{
  "version": 3,
  "sources": ["repository.ts"],
  "sourcesContent": ["import * as secretsmanager from '../../../aws-secretsmanager';\nimport { Annotations, Token } from '../../../core';\nimport { Construct } from 'constructs';\nimport { ContainerDefinition } from '../container-definition';\nimport { ContainerImage, ContainerImageConfig } from '../container-image';\n\n/**\n * Regex pattern to check if it is an ECR image URL.\n *\n */\nconst ECR_IMAGE_REGEX = /(^[a-zA-Z0-9][a-zA-Z0-9-_]*).dkr.ecr.([a-zA-Z0-9][a-zA-Z0-9-_]*).amazonaws.com(.cn)?\\/.*/;\n\n/**\n * The properties for an image hosted in a public or private repository.\n */\nexport interface RepositoryImageProps {\n  /**\n   * The secret to expose to the container that contains the credentials for the image repository.\n   * The supported value is the full ARN of an AWS Secrets Manager secret.\n   */\n  readonly credentials?: secretsmanager.ISecret;\n}\n\n/**\n * An image hosted in a public or private repository. For images hosted in Amazon ECR, see\n * [EcrImage](https://docs.aws.amazon.com/AmazonECR/latest/userguide/images.html).\n */\nexport class RepositoryImage extends ContainerImage {\n\n  /**\n   * Constructs a new instance of the RepositoryImage class.\n   */\n  constructor(private readonly imageName: string, private readonly props: RepositoryImageProps = {}) {\n    super();\n  }\n\n  public bind(scope: Construct, containerDefinition: ContainerDefinition): ContainerImageConfig {\n    // name could be a Token - in that case, skip validation altogether\n    if (!Token.isUnresolved(this.imageName) && ECR_IMAGE_REGEX.test(this.imageName)) {\n      Annotations.of(scope).addWarning(\"Proper policies need to be attached before pulling from ECR repository, or use 'fromEcrRepository'.\");\n    }\n\n    if (this.props.credentials) {\n      this.props.credentials.grantRead(containerDefinition.taskDefinition.obtainExecutionRole());\n    }\n\n    return {\n      imageName: this.imageName,\n      repositoryCredentials: this.props.credentials && {\n        credentialsParameter: this.props.credentials.secretArn,\n      },\n    };\n  }\n}\n"],
  "mappings": "yNACA,OAAA,QAAA,eAAA,EAGA,kBAAA,QAAA,oBAAA,EAMM,gBAAkB,2FAiBxB,MAAa,uBAAwB,mBAAA,cAAc,CAKjD,YAA6B,UAAoC,MAA8B,CAAA,EAAE,CAC/F,MAAK,EADsB,KAAA,UAAA,UAAoC,KAAA,MAAA,8EAI1D,KAAK,MAAkB,oBAAwC,6FAEhE,CAAC,OAAA,MAAM,aAAa,KAAK,SAAS,GAAK,gBAAgB,KAAK,KAAK,SAAS,GAC5E,OAAA,YAAY,GAAG,KAAK,EAAE,WAAW,qGAAqG,EAGpI,KAAK,MAAM,aACb,KAAK,MAAM,YAAY,UAAU,oBAAoB,eAAe,oBAAmB,CAAE,EAGpF,CACL,UAAW,KAAK,UAChB,sBAAuB,KAAK,MAAM,aAAe,CAC/C,qBAAsB,KAAK,MAAM,YAAY,aAtBrD,QAAA,gBAAA",
  "names": []
}
