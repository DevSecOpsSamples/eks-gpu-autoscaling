{
  "version": 3,
  "sources": ["tag-parameter-container-image.ts"],
  "sourcesContent": ["import * as ecr from '../../../aws-ecr';\nimport * as cdk from '../../../core';\nimport { Construct } from 'constructs';\nimport { ContainerDefinition } from '../container-definition';\nimport { ContainerImage, ContainerImageConfig } from '../container-image';\n\n/**\n * A special type of {@link ContainerImage} that uses an ECR repository for the image,\n * but a CloudFormation Parameter for the tag of the image in that repository.\n * This allows providing this tag through the Parameter at deploy time,\n * for example in a CodePipeline that pushes a new tag of the image to the repository during a build step,\n * and then provides that new tag through the CloudFormation Parameter in the deploy step.\n *\n * @see #tagParameterName\n */\nexport class TagParameterContainerImage extends ContainerImage {\n  private readonly repository: ecr.IRepository;\n  private imageTagParameter?: cdk.CfnParameter;\n\n  public constructor(repository: ecr.IRepository) {\n    super();\n    this.repository = repository;\n  }\n\n  public bind(scope: Construct, containerDefinition: ContainerDefinition): ContainerImageConfig {\n    this.repository.grantPull(containerDefinition.taskDefinition.obtainExecutionRole());\n    const imageTagParameter = new cdk.CfnParameter(scope, 'ImageTagParam');\n    this.imageTagParameter = imageTagParameter;\n    return {\n      imageName: this.repository.repositoryUriForTag(imageTagParameter.valueAsString),\n    };\n  }\n\n  /**\n   * Returns the name of the CloudFormation Parameter that represents the tag of the image\n   * in the ECR repository.\n   */\n  public get tagParameterName(): string {\n    return cdk.Lazy.string({\n      produce: () => {\n        if (this.imageTagParameter) {\n          return this.imageTagParameter.logicalId;\n        } else {\n          throw new Error('TagParameterContainerImage must be used in a container definition when using tagParameterName');\n        }\n      },\n    });\n  }\n\n  /**\n   * Returns the value of the CloudFormation Parameter that represents the tag of the image\n   * in the ECR repository.\n   */\n  public get tagParameterValue(): string {\n    return cdk.Lazy.string({\n      produce: () => {\n        if (this.imageTagParameter) {\n          return this.imageTagParameter.valueAsString;\n        } else {\n          throw new Error('TagParameterContainerImage must be used in a container definition when using tagParameterValue');\n        }\n      },\n    });\n  }\n}\n"],
  "mappings": "oOACA,IAAA,QAAA,eAAA,EAGA,kBAAA,QAAA,oBAAA,EAWA,MAAa,kCAAmC,mBAAA,cAAc,CAI5D,YAAmB,WAA2B,CAC5C,MAAK,sEACL,KAAK,WAAa,WAGb,KAAK,MAAkB,oBAAwC,sFACpE,KAAK,WAAW,UAAU,oBAAoB,eAAe,oBAAmB,CAAE,EAClF,KAAM,mBAAoB,GAAI,KAAI,aAAa,MAAO,eAAe,EACrE,YAAK,kBAAoB,kBAClB,CACL,UAAW,KAAK,WAAW,oBAAoB,kBAAkB,aAAa,MAQvE,mBAAgB,CACzB,MAAO,KAAI,KAAK,OAAO,CACrB,QAAS,IAAK,CACZ,GAAI,KAAK,kBACP,MAAO,MAAK,kBAAkB,UAE9B,KAAM,IAAI,OAAM,+FAA+F,CAEnH,EACD,KAOQ,oBAAiB,CAC1B,MAAO,KAAI,KAAK,OAAO,CACrB,QAAS,IAAK,CACZ,GAAI,KAAK,kBACP,MAAO,MAAK,kBAAkB,cAE9B,KAAM,IAAI,OAAM,gGAAgG,CAEpH,EACD,GA/CL,QAAA,2BAAA",
  "names": []
}
