{
  "version": 3,
  "sources": ["run-glue-job-task.ts"],
  "sourcesContent": ["import * as iam from '../../../aws-iam';\nimport * as sfn from '../../../aws-stepfunctions';\nimport { Duration, Stack } from '../../../core';\nimport { getResourceArn } from '../resource-arn-suffix';\n\n/**\n * Properties for RunGlueJobTask\n *\n * @deprecated use `GlueStartJobRun`\n */\nexport interface RunGlueJobTaskProps {\n\n  /**\n   * The service integration pattern indicates different ways to start the Glue job.\n   *\n   * The valid value for Glue is either FIRE_AND_FORGET or SYNC.\n   *\n   * @default FIRE_AND_FORGET\n   */\n  readonly integrationPattern?: sfn.ServiceIntegrationPattern;\n\n  /**\n   * The job arguments specifically for this run.\n   *\n   * For this job run, they replace the default arguments set in the job definition itself.\n   *\n   * @default - Default arguments set in the job definition\n   */\n  readonly arguments?: { [key: string]: string };\n\n  /**\n   * The job run timeout.\n   *\n   * This is the maximum time that a job run can consume resources before it is terminated and enters TIMEOUT status.\n   * Must be at least 1 minute.\n   *\n   * @default - Default timeout set in the job definition\n   */\n  readonly timeout?: Duration;\n\n  /**\n   * The name of the SecurityConfiguration structure to be used with this job run.\n   *\n   * This must match the Glue API\n   * [single-line string pattern](https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-common.html#aws-glue-api-regex-oneLine).\n   *\n   * @default - Default configuration set in the job definition\n   */\n  readonly securityConfiguration?: string;\n\n  /**\n   * After a job run starts, the number of minutes to wait before sending a job run delay notification.\n   *\n   * Must be at least 1 minute.\n   *\n   * @default - Default delay set in the job definition\n   */\n  readonly notifyDelayAfter?: Duration;\n}\n\n/**\n * Invoke a Glue job as a Task\n *\n * OUTPUT: the output of this task is a JobRun structure, for details consult\n * https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-jobs-runs.html#aws-glue-api-jobs-runs-JobRun\n *\n * @see https://docs.aws.amazon.com/step-functions/latest/dg/connect-glue.html\n *\n * @deprecated use `GlueStartJobRun`\n */\nexport class RunGlueJobTask implements sfn.IStepFunctionsTask {\n  private readonly integrationPattern: sfn.ServiceIntegrationPattern;\n\n  constructor(private readonly glueJobName: string, private readonly props: RunGlueJobTaskProps = {}) {\n    this.integrationPattern = props.integrationPattern || sfn.ServiceIntegrationPattern.FIRE_AND_FORGET;\n\n    const supportedPatterns = [\n      sfn.ServiceIntegrationPattern.FIRE_AND_FORGET,\n      sfn.ServiceIntegrationPattern.SYNC,\n    ];\n\n    if (!supportedPatterns.includes(this.integrationPattern)) {\n      throw new Error(`Invalid Service Integration Pattern: ${this.integrationPattern} is not supported to call Glue.`);\n    }\n  }\n\n  public bind(task: sfn.Task): sfn.StepFunctionsTaskConfig {\n    const notificationProperty = this.props.notifyDelayAfter ? { NotifyDelayAfter: this.props.notifyDelayAfter.toMinutes() } : null;\n    let iamActions: string[] | undefined;\n    if (this.integrationPattern === sfn.ServiceIntegrationPattern.FIRE_AND_FORGET) {\n      iamActions = ['glue:StartJobRun'];\n    } else if (this.integrationPattern === sfn.ServiceIntegrationPattern.SYNC) {\n      iamActions = [\n        'glue:StartJobRun',\n        'glue:GetJobRun',\n        'glue:GetJobRuns',\n        'glue:BatchStopJobRun',\n      ];\n    }\n    return {\n      resourceArn: getResourceArn('glue', 'startJobRun', this.integrationPattern),\n      policyStatements: [new iam.PolicyStatement({\n        resources: [\n          Stack.of(task).formatArn({\n            service: 'glue',\n            resource: 'job',\n            resourceName: this.glueJobName,\n          }),\n        ],\n        actions: iamActions,\n      })],\n      metricPrefixSingular: 'GlueJob',\n      metricPrefixPlural: 'GlueJobs',\n      metricDimensions: { GlueJobName: this.glueJobName },\n      parameters: {\n        JobName: this.glueJobName,\n        Arguments: this.props.arguments,\n        Timeout: this.props.timeout?.toMinutes(),\n        SecurityConfiguration: this.props.securityConfiguration,\n        NotificationProperty: notificationProperty,\n      },\n    };\n  }\n}\n"],
  "mappings": "0JAAA,IAAA,QAAA,kBAAA,EACA,IAAA,QAAA,4BAAA,EACA,OAAA,QAAA,eAAA,EACA,sBAAA,QAAA,wBAAA,EAmEA,MAAa,cAAc,CAGzB,YAA6B,YAAsC,MAA6B,CAAA,EAAE,CAQhG,GAR2B,KAAA,YAAA,YAAsC,KAAA,MAAA,MACjE,KAAK,mBAAqB,MAAM,oBAAsB,IAAI,0BAA0B,gBAOhF,CAAC,AALqB,CACxB,IAAI,0BAA0B,gBAC9B,IAAI,0BAA0B,MAGT,SAAS,KAAK,kBAAkB,EACrD,KAAM,IAAI,OAAM,wCAAwC,KAAK,mDAAmD,EAI7G,KAAK,KAAc,QACxB,KAAM,sBAAuB,KAAK,MAAM,iBAAmB,CAAE,iBAAkB,KAAK,MAAM,iBAAiB,UAAS,CAAE,EAAK,KAC3H,GAAI,YACJ,MAAI,MAAK,qBAAuB,IAAI,0BAA0B,gBAC5D,WAAa,CAAC,kBAAkB,EACvB,KAAK,qBAAuB,IAAI,0BAA0B,MACnE,YAAa,CACX,mBACA,iBACA,kBACA,yBAGG,CACL,YAAa,sBAAA,eAAe,OAAQ,cAAe,KAAK,kBAAkB,EAC1E,iBAAkB,CAAC,GAAI,KAAI,gBAAgB,CACzC,UAAW,CACT,OAAA,MAAM,GAAG,IAAI,EAAE,UAAU,CACvB,QAAS,OACT,SAAU,MACV,aAAc,KAAK,YACpB,GAEH,QAAS,WACV,CAAC,EACF,qBAAsB,UACtB,mBAAoB,WACpB,iBAAkB,CAAE,YAAa,KAAK,WAAW,EACjD,WAAY,CACV,QAAS,KAAK,YACd,UAAW,KAAK,MAAM,UACtB,QAAO,IAAE,KAAK,MAAM,WAAO,MAAA,KAAA,OAAA,OAAA,GAAE,UAAS,EACtC,sBAAuB,KAAK,MAAM,sBAClC,qBAAsB,wBAjD9B,QAAA,eAAA",
  "names": []
}
