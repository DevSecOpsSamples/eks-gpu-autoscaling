"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EvaluateExpression=void 0;const jsiiDeprecationWarnings=require("../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),path=require("path"),iam=require("../../aws-iam"),lambda=require("../../aws-lambda"),sfn=require("../../aws-stepfunctions");class EvaluateExpression extends sfn.TaskStateBase{constructor(scope,id,props){var _b;super(scope,id,props);this.props=props,jsiiDeprecationWarnings.aws_cdk_lib_aws_stepfunctions_tasks_EvaluateExpressionProps(props),this.evalFn=createEvalFn((_b=this.props.runtime)!==null&&_b!==void 0?_b:lambda.Runtime.NODEJS_14_X,this),this.taskPolicies=[new iam.PolicyStatement({resources:this.evalFn.resourceArnsForGrantInvoke,actions:["lambda:InvokeFunction"]})]}_renderTask(){const matches=this.props.expression.match(/\$[.\[][.a-zA-Z[\]0-9-_]+/g);let expressionAttributeValues={};matches&&(expressionAttributeValues=matches.reduce((acc,m)=>({...acc,[m]:sfn.JsonPath.stringAt(m)}),{}));const parameters={expression:this.props.expression,expressionAttributeValues};return{Resource:this.evalFn.functionArn,Parameters:sfn.FieldUtils.renderObject(parameters)}}}exports.EvaluateExpression=EvaluateExpression,_a=JSII_RTTI_SYMBOL_1,EvaluateExpression[_a]={fqn:"aws-cdk-lib.aws_stepfunctions_tasks.EvaluateExpression",version:"2.20.0"};function createEvalFn(runtime,scope){const lambdaPurpose="Eval",nodeJsGuids={[lambda.Runtime.NODEJS_14_X.name]:"da2d1181-604e-4a45-8694-1a6abd7fe42d",[lambda.Runtime.NODEJS_12_X.name]:"2b81e383-aad2-44db-8aaf-b4809ae0e3b4",[lambda.Runtime.NODEJS_10_X.name]:"a0d2ce44-871b-4e74-87a1-f5e63d7c3bdc"};switch(runtime){case lambda.Runtime.NODEJS_14_X:case lambda.Runtime.NODEJS_12_X:case lambda.Runtime.NODEJS_10_X:const uuid=nodeJsGuids[runtime.name];if(uuid)return new lambda.SingletonFunction(scope,"EvalFunction",{runtime,uuid,handler:"index.handler",lambdaPurpose,code:lambda.Code.fromAsset(path.join(__dirname,"eval-nodejs-handler"))});break}throw new Error(`The runtime ${runtime.name} is currently not supported.`)}
//# sourceMappingURL=evaluate-expression.js.map
