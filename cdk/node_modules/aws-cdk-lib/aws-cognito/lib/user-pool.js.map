{
  "version": 3,
  "sources": ["user-pool.ts"],
  "sourcesContent": ["import { IRole, PolicyDocument, PolicyStatement, Role, ServicePrincipal } from '../../aws-iam';\nimport { IKey } from '../../aws-kms';\nimport * as lambda from '../../aws-lambda';\nimport { ArnFormat, Duration, IResource, Lazy, Names, RemovalPolicy, Resource, Stack, Token } from '../../core';\nimport { Construct } from 'constructs';\nimport { toASCII as punycodeEncode } from 'punycode/';\nimport { CfnUserPool } from './cognito.generated';\nimport { StandardAttributeNames } from './private/attr-names';\nimport { ICustomAttribute, StandardAttribute, StandardAttributes } from './user-pool-attr';\nimport { UserPoolClient, UserPoolClientOptions } from './user-pool-client';\nimport { UserPoolDomain, UserPoolDomainOptions } from './user-pool-domain';\nimport { UserPoolEmail } from './user-pool-email';\nimport { IUserPoolIdentityProvider } from './user-pool-idp';\nimport { UserPoolResourceServer, UserPoolResourceServerOptions } from './user-pool-resource-server';\n\n/**\n * The different ways in which users of this pool can sign up or sign in.\n */\nexport interface SignInAliases {\n  /**\n   * Whether user is allowed to sign up or sign in with a username\n   * @default true\n   */\n  readonly username?: boolean;\n\n  /**\n   * Whether a user is allowed to sign up or sign in with an email address\n   * @default false\n   */\n  readonly email?: boolean;\n\n  /**\n   * Whether a user is allowed to sign up or sign in with a phone number\n   * @default false\n   */\n  readonly phone?: boolean;\n\n  /**\n   * Whether a user is allowed to sign in with a secondary username, that can be set and modified after sign up.\n   * Can only be used in conjunction with `USERNAME`.\n   * @default false\n   */\n  readonly preferredUsername?: boolean;\n}\n\n/**\n * Attributes that can be automatically verified for users in a user pool.\n */\nexport interface AutoVerifiedAttrs {\n  /**\n   * Whether the email address of the user should be auto verified at sign up.\n   *\n   * Note: If both `email` and `phone` is set, Cognito only verifies the phone number. To also verify email, see here -\n   * https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-email-phone-verification.html\n   *\n   * @default - true, if email is turned on for `signIn`. false, otherwise.\n   */\n  readonly email?: boolean;\n\n  /**\n   * Whether the phone number of the user should be auto verified at sign up.\n   * @default - true, if phone is turned on for `signIn`. false, otherwise.\n   */\n  readonly phone?: boolean;\n}\n\n/**\n * Triggers for a user pool\n * @see https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html\n */\nexport interface UserPoolTriggers {\n  /**\n   * Creates an authentication challenge.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-create-auth-challenge.html\n   * @default - no trigger configured\n   */\n  readonly createAuthChallenge?: lambda.IFunction;\n\n  /**\n   * A custom Message AWS Lambda trigger.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-custom-message.html\n   * @default - no trigger configured\n   */\n  readonly customMessage?: lambda.IFunction;\n\n  /**\n   * Defines the authentication challenge.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-define-auth-challenge.html\n   * @default - no trigger configured\n   */\n  readonly defineAuthChallenge?: lambda.IFunction;\n\n  /**\n   * A post-authentication AWS Lambda trigger.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-authentication.html\n   * @default - no trigger configured\n   */\n  readonly postAuthentication?: lambda.IFunction;\n\n  /**\n   * A post-confirmation AWS Lambda trigger.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-confirmation.html\n   * @default - no trigger configured\n   */\n  readonly postConfirmation?: lambda.IFunction;\n\n  /**\n   * A pre-authentication AWS Lambda trigger.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-authentication.html\n   * @default - no trigger configured\n   */\n  readonly preAuthentication?: lambda.IFunction;\n\n  /**\n   * A pre-registration AWS Lambda trigger.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-sign-up.html\n   * @default - no trigger configured\n   */\n  readonly preSignUp?: lambda.IFunction;\n\n  /**\n   * A pre-token-generation AWS Lambda trigger.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-token-generation.html\n   * @default - no trigger configured\n   */\n  readonly preTokenGeneration?: lambda.IFunction;\n\n  /**\n   * A user-migration AWS Lambda trigger.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-migrate-user.html\n   * @default - no trigger configured\n   */\n  readonly userMigration?: lambda.IFunction;\n\n  /**\n   * Verifies the authentication challenge response.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-verify-auth-challenge-response.html\n   * @default - no trigger configured\n   */\n  readonly verifyAuthChallengeResponse?: lambda.IFunction;\n\n  /**\n   * Amazon Cognito invokes this trigger to send email notifications to users.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-custom-email-sender.html\n   * @default - no trigger configured\n   */\n  readonly customEmailSender?: lambda.IFunction\n\n  /**\n   * Amazon Cognito invokes this trigger to send SMS notifications to users.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-custom-sms-sender.html\n   * @default - no trigger configured\n   */\n  readonly customSmsSender?: lambda.IFunction\n\n  /**\n   * Index signature\n   */\n  [trigger: string]: lambda.IFunction | undefined;\n}\n\n/**\n * User pool operations to which lambda triggers can be attached.\n */\nexport class UserPoolOperation {\n  /**\n   * Creates a challenge in a custom auth flow\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-create-auth-challenge.html\n   */\n  public static readonly CREATE_AUTH_CHALLENGE = new UserPoolOperation('createAuthChallenge');\n\n  /**\n   * Advanced customization and localization of messages\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-custom-message.html\n   */\n  public static readonly CUSTOM_MESSAGE = new UserPoolOperation('customMessage');\n\n  /**\n   * Determines the next challenge in a custom auth flow\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-define-auth-challenge.html\n   */\n  public static readonly DEFINE_AUTH_CHALLENGE = new UserPoolOperation('defineAuthChallenge');\n\n  /**\n   * Event logging for custom analytics\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-authentication.html\n   */\n  public static readonly POST_AUTHENTICATION = new UserPoolOperation('postAuthentication');\n\n  /**\n   * Custom welcome messages or event logging for custom analytics\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-confirmation.html\n   */\n  public static readonly POST_CONFIRMATION = new UserPoolOperation('postConfirmation');\n\n  /**\n   * Custom validation to accept or deny the sign-in request\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-authentication.html\n   */\n  public static readonly PRE_AUTHENTICATION = new UserPoolOperation('preAuthentication');\n\n  /**\n   * Custom validation to accept or deny the sign-up request\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-sign-up.html\n   */\n  public static readonly PRE_SIGN_UP = new UserPoolOperation('preSignUp');\n\n  /**\n   * Add or remove attributes in Id tokens\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-token-generation.html\n   */\n  public static readonly PRE_TOKEN_GENERATION = new UserPoolOperation('preTokenGeneration');\n\n  /**\n   * Migrate a user from an existing user directory to user pools\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-migrate-user.html\n   */\n  public static readonly USER_MIGRATION = new UserPoolOperation('userMigration');\n\n  /**\n   * Determines if a response is correct in a custom auth flow\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-verify-auth-challenge-response.html\n   */\n  public static readonly VERIFY_AUTH_CHALLENGE_RESPONSE = new UserPoolOperation('verifyAuthChallengeResponse');\n\n  /**\n   * Amazon Cognito invokes this trigger to send email notifications to users.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-custom-email-sender.html\n   */\n  public static readonly CUSTOM_EMAIL_SENDER = new UserPoolOperation('customEmailSender');\n\n  /**\n   * Amazon Cognito invokes this trigger to send email notifications to users.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-custom-sms-sender.html\n   */\n  public static readonly CUSTOM_SMS_SENDER = new UserPoolOperation('customSmsSender');\n\n  /** A custom user pool operation */\n  public static of(name: string): UserPoolOperation {\n    const lowerCamelCase = name.charAt(0).toLowerCase() + name.slice(1);\n    return new UserPoolOperation(lowerCamelCase);\n  }\n\n  /** The key to use in `CfnUserPool.LambdaConfigProperty` */\n  public readonly operationName: string;\n\n  private constructor(operationName: string) {\n    this.operationName = operationName;\n  }\n}\n\n/**\n * The email verification style\n */\nexport enum VerificationEmailStyle {\n  /** Verify email via code */\n  CODE = 'CONFIRM_WITH_CODE',\n  /** Verify email via link */\n  LINK = 'CONFIRM_WITH_LINK',\n}\n\n/**\n * User pool configuration for user self sign up.\n */\nexport interface UserVerificationConfig {\n  /**\n   * The email subject template for the verification email sent to the user upon sign up.\n   * See https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-message-templates.html to\n   * learn more about message templates.\n   * @default 'Verify your new account'\n   */\n  readonly emailSubject?: string;\n\n  /**\n   * The email body template for the verification email sent to the user upon sign up.\n   * See https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-message-templates.html to\n   * learn more about message templates.\n   *\n   * @default - 'The verification code to your new account is {####}' if VerificationEmailStyle.CODE is chosen,\n   * 'Verify your account by clicking on {##Verify Email##}' if VerificationEmailStyle.LINK is chosen.\n   */\n  readonly emailBody?: string;\n\n  /**\n   * Emails can be verified either using a code or a link.\n   * Learn more at https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-email-verification-message-customization.html\n   * @default VerificationEmailStyle.CODE\n   */\n  readonly emailStyle?: VerificationEmailStyle;\n\n  /**\n   * The message template for the verification SMS sent to the user upon sign up.\n   * See https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-message-templates.html to\n   * learn more about message templates.\n   *\n   * @default - 'The verification code to your new account is {####}' if VerificationEmailStyle.CODE is chosen,\n   * not configured if VerificationEmailStyle.LINK is chosen\n   */\n  readonly smsMessage?: string;\n}\n\n/**\n * User pool configuration when administrators sign users up.\n */\nexport interface UserInvitationConfig {\n  /**\n   * The template to the email subject that is sent to the user when an administrator signs them up to the user pool.\n   * @default 'Your temporary password'\n   */\n  readonly emailSubject?: string;\n\n  /**\n   * The template to the email body that is sent to the user when an administrator signs them up to the user pool.\n   * @default 'Your username is {username} and temporary password is {####}.'\n   */\n  readonly emailBody?: string;\n\n  /**\n   * The template to the SMS message that is sent to the user when an administrator signs them up to the user pool.\n   * @default 'Your username is {username} and temporary password is {####}'\n   */\n  readonly smsMessage?: string;\n}\n\n/**\n * The different ways in which a user pool's MFA enforcement can be configured.\n * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa.html\n */\nexport enum Mfa {\n  /** Users are not required to use MFA for sign in, and cannot configure one. */\n  OFF = 'OFF',\n  /** Users are not required to use MFA for sign in, but can configure one if they so choose to. */\n  OPTIONAL = 'OPTIONAL',\n  /** Users are required to configure an MFA, and have to use it to sign in. */\n  REQUIRED = 'ON',\n}\n\n/**\n * The different ways in which a user pool can obtain their MFA token for sign in.\n * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa.html\n */\nexport interface MfaSecondFactor {\n  /**\n   * The MFA token is sent to the user via SMS to their verified phone numbers\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa-sms-text-message.html\n   * @default true\n   */\n  readonly sms: boolean;\n\n  /**\n   * The MFA token is a time-based one time password that is generated by a hardware or software token\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa-totp.html\n   * @default false\n   */\n  readonly otp: boolean;\n}\n\n/**\n * Password policy for User Pools.\n */\nexport interface PasswordPolicy {\n  /**\n   * The length of time the temporary password generated by an admin is valid.\n   * This must be provided as whole days, like Duration.days(3) or Duration.hours(48).\n   * Fractional days, such as Duration.hours(20), will generate an error.\n   * @default Duration.days(7)\n   */\n  readonly tempPasswordValidity?: Duration;\n\n  /**\n   * Minimum length required for a user's password.\n   * @default 8\n   */\n  readonly minLength?: number;\n\n  /**\n   * Whether the user is required to have lowercase characters in their password.\n   * @default true\n   */\n  readonly requireLowercase?: boolean;\n\n  /**\n   * Whether the user is required to have uppercase characters in their password.\n   * @default true\n   */\n  readonly requireUppercase?: boolean;\n\n  /**\n   * Whether the user is required to have digits in their password.\n   * @default true\n   */\n  readonly requireDigits?: boolean;\n\n  /**\n   * Whether the user is required to have symbols in their password.\n   * @default true\n   */\n  readonly requireSymbols?: boolean;\n}\n\n/**\n * Email settings for the user pool.\n */\nexport interface EmailSettings {\n  /**\n   * The 'from' address on the emails received by the user.\n   * @default noreply@verificationemail.com\n   */\n  readonly from?: string;\n\n  /**\n   * The 'replyTo' address on the emails received by the user as defined by IETF RFC-5322.\n   * When set, most email clients recognize to change 'to' line to this address when a reply is drafted.\n   * @default - Not set.\n   */\n  readonly replyTo?: string;\n}\n\n/**\n * How will a user be able to recover their account?\n *\n * When a user forgets their password, they can have a code sent to their verified email or verified phone to recover their account.\n * You can choose the preferred way to send codes below.\n * We recommend not allowing phone to be used for both password resets and multi-factor authentication (MFA).\n *\n * @see https://docs.aws.amazon.com/cognito/latest/developerguide/how-to-recover-a-user-account.html\n */\nexport enum AccountRecovery {\n  /**\n   * Email if available, otherwise phone, but don\u2019t allow a user to reset their password via phone if they are also using it for MFA\n   */\n  EMAIL_AND_PHONE_WITHOUT_MFA,\n\n  /**\n   * Phone if available, otherwise email, but don\u2019t allow a user to reset their password via phone if they are also using it for MFA\n   */\n  PHONE_WITHOUT_MFA_AND_EMAIL,\n\n  /**\n   * Email only\n   */\n  EMAIL_ONLY,\n\n  /**\n   * Phone only, but don\u2019t allow a user to reset their password via phone if they are also using it for MFA\n   */\n  PHONE_ONLY_WITHOUT_MFA,\n\n  /**\n   * (Not Recommended) Phone if available, otherwise email, and do allow a user to reset their password via phone if they are also using it for MFA.\n   */\n  PHONE_AND_EMAIL,\n\n  /**\n   * None \u2013 users will have to contact an administrator to reset their passwords\n   */\n  NONE,\n}\n\n/**\n * Device tracking settings\n * @see https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-device-tracking.html\n */\nexport interface DeviceTracking {\n  /**\n   * Indicates whether a challenge is required on a new device. Only applicable to a new device.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-device-tracking.html\n   * @default false\n   */\n  readonly challengeRequiredOnNewDevice: boolean;\n\n  /**\n   * If true, a device is only remembered on user prompt.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-device-tracking.html\n   * @default false\n   */\n  readonly deviceOnlyRememberedOnUserPrompt: boolean;\n}\n\n/**\n * Props for the UserPool construct\n */\nexport interface UserPoolProps {\n  /**\n   * Name of the user pool\n   *\n   * @default - automatically generated name by CloudFormation at deploy time\n   */\n  readonly userPoolName?: string;\n\n  /**\n   * Whether self sign up should be enabled. This can be further configured via the `selfSignUp` property.\n   * @default false\n   */\n  readonly selfSignUpEnabled?: boolean;\n\n  /**\n   * Configuration around users signing themselves up to the user pool.\n   * Enable or disable self sign-up via the `selfSignUpEnabled` property.\n   * @default - see defaults in UserVerificationConfig\n   */\n  readonly userVerification?: UserVerificationConfig;\n\n  /**\n   * Configuration around admins signing up users into a user pool.\n   * @default - see defaults in UserInvitationConfig\n   */\n  readonly userInvitation?: UserInvitationConfig;\n\n  /**\n   * The IAM role that Cognito will assume while sending SMS messages.\n   * @default - a new IAM role is created\n   */\n  readonly smsRole?: IRole;\n\n  /**\n   * The 'ExternalId' that Cognito service must using when assuming the `smsRole`, if the role is restricted with an 'sts:ExternalId' conditional.\n   * Learn more about ExternalId here - https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user_externalid.html\n   *\n   * This property will be ignored if `smsRole` is not specified.\n   * @default - No external id will be configured\n   */\n  readonly smsRoleExternalId?: string;\n\n  /**\n   * The region to integrate with SNS to send SMS messages\n   *\n   * This property will do nothing if SMS configuration is not configured\n   * @default - The same region as the user pool, with a few exceptions - https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-sms-settings.html#user-pool-sms-settings-first-time\n   */\n  readonly snsRegion?: string;\n\n  /**\n   * Setting this would explicitly enable or disable SMS role creation.\n   * When left unspecified, CDK will determine based on other properties if a role is needed or not.\n   * @default - CDK will determine based on other properties of the user pool if an SMS role should be created or not.\n   */\n  readonly enableSmsRole?: boolean;\n\n  /**\n   * Methods in which a user registers or signs in to a user pool.\n   * Allows either username with aliases OR sign in with email, phone, or both.\n   *\n   * Read the sections on usernames and aliases to learn more -\n   * https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html\n   *\n   * To match with 'Option 1' in the above link, with a verified email, this property should be set to\n   * `{ username: true, email: true }`. To match with 'Option 2' in the above link with both a verified email and phone\n   * number, this property should be set to `{ email: true, phone: true }`.\n   *\n   * @default { username: true }\n   */\n  readonly signInAliases?: SignInAliases;\n\n  /**\n   * Attributes which Cognito will look to verify automatically upon user sign up.\n   * EMAIL and PHONE are the only available options.\n   *\n   * @default - If `signInAlias` includes email and/or phone, they will be included in `autoVerifiedAttributes` by default.\n   * If absent, no attributes will be auto-verified.\n   */\n  readonly autoVerify?: AutoVerifiedAttrs;\n\n  /**\n   * The set of attributes that are required for every user in the user pool.\n   * Read more on attributes here - https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html\n   *\n   * @default - All standard attributes are optional and mutable.\n   */\n  readonly standardAttributes?: StandardAttributes;\n\n  /**\n   * Define a set of custom attributes that can be configured for each user in the user pool.\n   *\n   * @default - No custom attributes.\n   */\n  readonly customAttributes?: { [key: string]: ICustomAttribute };\n\n  /**\n   * Configure whether users of this user pool can or are required use MFA to sign in.\n   *\n   * @default Mfa.OFF\n   */\n  readonly mfa?: Mfa;\n\n  /**\n   * The SMS message template sent during MFA verification.\n   * Use '{####}' in the template where Cognito should insert the verification code.\n   * @default 'Your authentication code is {####}.'\n   */\n  readonly mfaMessage?: string;\n\n  /**\n   * Configure the MFA types that users can use in this user pool. Ignored if `mfa` is set to `OFF`.\n   *\n   * @default - { sms: true, otp: false }, if `mfa` is set to `OPTIONAL` or `REQUIRED`.\n   * { sms: false, otp: false }, otherwise\n   */\n  readonly mfaSecondFactor?: MfaSecondFactor;\n\n  /**\n   * Password policy for this user pool.\n   * @default - see defaults on each property of PasswordPolicy.\n   */\n  readonly passwordPolicy?: PasswordPolicy;\n\n  /**\n   * Email settings for a user pool.\n   *\n   * @default - see defaults on each property of EmailSettings.\n   * @deprecated Use 'email' instead.\n   */\n  readonly emailSettings?: EmailSettings;\n\n  /**\n   * Email settings for a user pool.\n   * @default - cognito will use the default email configuration\n   */\n  readonly email?: UserPoolEmail;\n\n  /**\n   * Lambda functions to use for supported Cognito triggers.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html\n   * @default - No Lambda triggers.\n   */\n  readonly lambdaTriggers?: UserPoolTriggers;\n\n  /**\n   * Whether sign-in aliases should be evaluated with case sensitivity.\n   * For example, when this option is set to false, users will be able to sign in using either `MyUsername` or `myusername`.\n   * @default true\n   */\n  readonly signInCaseSensitive?: boolean;\n\n  /**\n   * How will a user be able to recover their account?\n   *\n   * @default AccountRecovery.PHONE_WITHOUT_MFA_AND_EMAIL\n   */\n  readonly accountRecovery?: AccountRecovery;\n\n  /**\n   * Policy to apply when the user pool is removed from the stack\n   *\n   * @default RemovalPolicy.RETAIN\n   */\n  readonly removalPolicy?: RemovalPolicy;\n\n  /**\n   * Device tracking settings\n   * @default - see defaults on each property of DeviceTracking.\n   */\n  readonly deviceTracking?: DeviceTracking;\n\n  /**\n   * This key will be used to encrypt temporary passwords and authorization codes that Amazon Cognito generates.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-custom-sender-triggers.html\n   * @default - no key ID configured\n   */\n  readonly customSenderKmsKey?: IKey;\n}\n\n/**\n * Represents a Cognito UserPool\n */\nexport interface IUserPool extends IResource {\n  /**\n   * The physical ID of this user pool resource\n   * @attribute\n   */\n  readonly userPoolId: string;\n\n  /**\n   * The ARN of this user pool resource\n   * @attribute\n   */\n  readonly userPoolArn: string;\n\n  /**\n   * Get all identity providers registered with this user pool.\n   */\n  readonly identityProviders: IUserPoolIdentityProvider[];\n\n  /**\n   * Add a new app client to this user pool.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html\n   */\n  addClient(id: string, options?: UserPoolClientOptions): UserPoolClient;\n\n  /**\n   * Associate a domain to this user pool.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-assign-domain.html\n   */\n  addDomain(id: string, options: UserPoolDomainOptions): UserPoolDomain;\n\n  /**\n   * Add a new resource server to this user pool.\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-resource-servers.html\n   */\n  addResourceServer(id: string, options: UserPoolResourceServerOptions): UserPoolResourceServer;\n\n  /**\n   * Register an identity provider with this user pool.\n   */\n  registerIdentityProvider(provider: IUserPoolIdentityProvider): void;\n}\n\nabstract class UserPoolBase extends Resource implements IUserPool {\n  public abstract readonly userPoolId: string;\n  public abstract readonly userPoolArn: string;\n  public readonly identityProviders: IUserPoolIdentityProvider[] = [];\n\n  public addClient(id: string, options?: UserPoolClientOptions): UserPoolClient {\n    return new UserPoolClient(this, id, {\n      userPool: this,\n      ...options,\n    });\n  }\n\n  public addDomain(id: string, options: UserPoolDomainOptions): UserPoolDomain {\n    return new UserPoolDomain(this, id, {\n      userPool: this,\n      ...options,\n    });\n  }\n\n  public addResourceServer(id: string, options: UserPoolResourceServerOptions): UserPoolResourceServer {\n    return new UserPoolResourceServer(this, id, {\n      userPool: this,\n      ...options,\n    });\n  }\n\n  public registerIdentityProvider(provider: IUserPoolIdentityProvider) {\n    this.identityProviders.push(provider);\n  }\n}\n\n/**\n * Define a Cognito User Pool\n */\nexport class UserPool extends UserPoolBase {\n  /**\n   * Import an existing user pool based on its id.\n   */\n  public static fromUserPoolId(scope: Construct, id: string, userPoolId: string): IUserPool {\n    let userPoolArn = Stack.of(scope).formatArn({\n      service: 'cognito-idp',\n      resource: 'userpool',\n      resourceName: userPoolId,\n    });\n\n    return UserPool.fromUserPoolArn(scope, id, userPoolArn);\n  }\n\n  /**\n   * Import an existing user pool based on its ARN.\n   */\n  public static fromUserPoolArn(scope: Construct, id: string, userPoolArn: string): IUserPool {\n    const arnParts = Stack.of(scope).splitArn(userPoolArn, ArnFormat.SLASH_RESOURCE_NAME);\n\n    if (!arnParts.resourceName) {\n      throw new Error('invalid user pool ARN');\n    }\n\n    const userPoolId = arnParts.resourceName;\n\n    class ImportedUserPool extends UserPoolBase {\n      public readonly userPoolArn = userPoolArn;\n      public readonly userPoolId = userPoolId;\n      constructor() {\n        super(scope, id, {\n          account: arnParts.account,\n          region: arnParts.region,\n        });\n      }\n    }\n\n    return new ImportedUserPool();\n  }\n\n  /**\n   * The physical ID of this user pool resource\n   */\n  public readonly userPoolId: string;\n\n  /**\n   * The ARN of the user pool\n   */\n  public readonly userPoolArn: string;\n\n  /**\n   * User pool provider name\n   * @attribute\n   */\n  public readonly userPoolProviderName: string;\n\n  /**\n   * User pool provider URL\n   * @attribute\n   */\n  public readonly userPoolProviderUrl: string;\n\n  private triggers: CfnUserPool.LambdaConfigProperty = {};\n\n  constructor(scope: Construct, id: string, props: UserPoolProps = {}) {\n    super(scope, id);\n\n    const signIn = this.signInConfiguration(props);\n\n    if (props.customSenderKmsKey) {\n      const kmsKey = props.customSenderKmsKey;\n      (this.triggers as any).kmsKeyId = kmsKey.keyArn;\n    }\n\n    if (props.lambdaTriggers) {\n      for (const t of Object.keys(props.lambdaTriggers)) {\n        let trigger: lambda.IFunction | undefined;\n        switch (t) {\n          case 'customSmsSender':\n          case 'customEmailSender':\n            if (!this.triggers.kmsKeyId) {\n              throw new Error('you must specify a KMS key if you are using customSmsSender or customEmailSender.');\n            }\n            trigger = props.lambdaTriggers[t];\n            const version = 'V1_0';\n            if (trigger !== undefined) {\n              this.addLambdaPermission(trigger as lambda.IFunction, t);\n              (this.triggers as any)[t] = {\n                lambdaArn: trigger.functionArn,\n                lambdaVersion: version,\n              };\n            }\n            break;\n          default:\n            trigger = props.lambdaTriggers[t] as lambda.IFunction | undefined;\n            if (trigger !== undefined) {\n              this.addLambdaPermission(trigger as lambda.IFunction, t);\n              (this.triggers as any)[t] = (trigger as lambda.IFunction).functionArn;\n            }\n            break;\n        }\n      }\n    }\n\n    const verificationMessageTemplate = this.verificationMessageConfiguration(props);\n    let emailVerificationMessage;\n    let emailVerificationSubject;\n    if (verificationMessageTemplate.defaultEmailOption === VerificationEmailStyle.CODE) {\n      emailVerificationMessage = verificationMessageTemplate.emailMessage;\n      emailVerificationSubject = verificationMessageTemplate.emailSubject;\n    }\n    const smsVerificationMessage = verificationMessageTemplate.smsMessage;\n    const inviteMessageTemplate: CfnUserPool.InviteMessageTemplateProperty = {\n      emailMessage: props.userInvitation?.emailBody,\n      emailSubject: props.userInvitation?.emailSubject,\n      smsMessage: props.userInvitation?.smsMessage,\n    };\n    const selfSignUpEnabled = props.selfSignUpEnabled ?? false;\n    const adminCreateUserConfig: CfnUserPool.AdminCreateUserConfigProperty = {\n      allowAdminCreateUserOnly: !selfSignUpEnabled,\n      inviteMessageTemplate: props.userInvitation !== undefined ? inviteMessageTemplate : undefined,\n    };\n\n    const passwordPolicy = this.configurePasswordPolicy(props);\n\n    if (props.email && props.emailSettings) {\n      throw new Error('you must either provide \"email\" or \"emailSettings\", but not both');\n    }\n    const emailConfiguration = props.email ? props.email._bind(this) : undefinedIfNoKeys({\n      from: encodePuny(props.emailSettings?.from),\n      replyToEmailAddress: encodePuny(props.emailSettings?.replyTo),\n    });\n\n    const userPool = new CfnUserPool(this, 'Resource', {\n      userPoolName: props.userPoolName,\n      usernameAttributes: signIn.usernameAttrs,\n      aliasAttributes: signIn.aliasAttrs,\n      autoVerifiedAttributes: signIn.autoVerifyAttrs,\n      lambdaConfig: Lazy.any({ produce: () => undefinedIfNoKeys(this.triggers) }),\n      smsAuthenticationMessage: this.mfaMessage(props),\n      smsConfiguration: this.smsConfiguration(props),\n      adminCreateUserConfig,\n      emailVerificationMessage,\n      emailVerificationSubject,\n      smsVerificationMessage,\n      verificationMessageTemplate,\n      schema: this.schemaConfiguration(props),\n      mfaConfiguration: props.mfa,\n      enabledMfas: this.mfaConfiguration(props),\n      policies: passwordPolicy !== undefined ? { passwordPolicy } : undefined,\n      emailConfiguration,\n      usernameConfiguration: undefinedIfNoKeys({\n        caseSensitive: props.signInCaseSensitive,\n      }),\n      accountRecoverySetting: this.accountRecovery(props),\n      deviceConfiguration: props.deviceTracking,\n    });\n    userPool.applyRemovalPolicy(props.removalPolicy);\n\n    this.userPoolId = userPool.ref;\n    this.userPoolArn = userPool.attrArn;\n\n    this.userPoolProviderName = userPool.attrProviderName;\n    this.userPoolProviderUrl = userPool.attrProviderUrl;\n  }\n\n  /**\n   * Add a lambda trigger to a user pool operation\n   * @see https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html\n   */\n  public addTrigger(operation: UserPoolOperation, fn: lambda.IFunction): void {\n    if (operation.operationName in this.triggers) {\n      throw new Error(`A trigger for the operation ${operation.operationName} already exists.`);\n    }\n\n    this.addLambdaPermission(fn, operation.operationName);\n    switch (operation.operationName) {\n      case 'customEmailSender':\n      case 'customSmsSender':\n        if (!this.triggers.kmsKeyId) {\n          throw new Error('you must specify a KMS key if you are using customSmsSender or customEmailSender.');\n        }\n        (this.triggers as any)[operation.operationName] = {\n          lambdaArn: fn.functionArn,\n          lambdaVersion: 'V1_0',\n        };\n        break;\n      default:\n        (this.triggers as any)[operation.operationName] = fn.functionArn;\n    }\n\n  }\n\n  private addLambdaPermission(fn: lambda.IFunction, name: string): void {\n    const capitalize = name.charAt(0).toUpperCase() + name.slice(1);\n    fn.addPermission(`${capitalize}Cognito`, {\n      principal: new ServicePrincipal('cognito-idp.amazonaws.com'),\n      sourceArn: Lazy.string({ produce: () => this.userPoolArn }),\n    });\n  }\n\n  private mfaMessage(props: UserPoolProps): string | undefined {\n    const CODE_TEMPLATE = '{####}';\n    const MAX_LENGTH = 140;\n    const message = props.mfaMessage;\n\n    if (message && !Token.isUnresolved(message)) {\n      if (!message.includes(CODE_TEMPLATE)) {\n        throw new Error(`MFA message must contain the template string '${CODE_TEMPLATE}'`);\n      }\n\n      if (message.length > MAX_LENGTH) {\n        throw new Error(`MFA message must be between ${CODE_TEMPLATE.length} and ${MAX_LENGTH} characters`);\n      }\n    }\n\n    return message;\n  }\n\n  private verificationMessageConfiguration(props: UserPoolProps): CfnUserPool.VerificationMessageTemplateProperty {\n    const CODE_TEMPLATE = '{####}';\n    const VERIFY_EMAIL_TEMPLATE = '{##Verify Email##}';\n\n    const emailStyle = props.userVerification?.emailStyle ?? VerificationEmailStyle.CODE;\n    const emailSubject = props.userVerification?.emailSubject ?? 'Verify your new account';\n    const smsMessage = props.userVerification?.smsMessage ?? `The verification code to your new account is ${CODE_TEMPLATE}`;\n\n    if (emailStyle === VerificationEmailStyle.CODE) {\n      const emailMessage = props.userVerification?.emailBody ?? `The verification code to your new account is ${CODE_TEMPLATE}`;\n      if (!Token.isUnresolved(emailMessage) && emailMessage.indexOf(CODE_TEMPLATE) < 0) {\n        throw new Error(`Verification email body must contain the template string '${CODE_TEMPLATE}'`);\n      }\n      if (!Token.isUnresolved(smsMessage) && smsMessage.indexOf(CODE_TEMPLATE) < 0) {\n        throw new Error(`SMS message must contain the template string '${CODE_TEMPLATE}'`);\n      }\n      return {\n        defaultEmailOption: VerificationEmailStyle.CODE,\n        emailMessage,\n        emailSubject,\n        smsMessage,\n      };\n    } else {\n      const emailMessage = props.userVerification?.emailBody ??\n        `Verify your account by clicking on ${VERIFY_EMAIL_TEMPLATE}`;\n      if (!Token.isUnresolved(emailMessage) && emailMessage.indexOf(VERIFY_EMAIL_TEMPLATE) < 0) {\n        throw new Error(`Verification email body must contain the template string '${VERIFY_EMAIL_TEMPLATE}'`);\n      }\n      return {\n        defaultEmailOption: VerificationEmailStyle.LINK,\n        emailMessageByLink: emailMessage,\n        emailSubjectByLink: emailSubject,\n        smsMessage,\n      };\n    }\n  }\n\n  private signInConfiguration(props: UserPoolProps) {\n    let aliasAttrs: string[] | undefined;\n    let usernameAttrs: string[] | undefined;\n    let autoVerifyAttrs: string[] | undefined;\n\n    const signIn: SignInAliases = props.signInAliases ?? { username: true };\n\n    if (signIn.preferredUsername && !signIn.username) {\n      throw new Error('username signIn must be enabled if preferredUsername is enabled');\n    }\n\n    if (signIn.username) {\n      aliasAttrs = [];\n      if (signIn.email) { aliasAttrs.push(StandardAttributeNames.email); }\n      if (signIn.phone) { aliasAttrs.push(StandardAttributeNames.phoneNumber); }\n      if (signIn.preferredUsername) { aliasAttrs.push(StandardAttributeNames.preferredUsername); }\n      if (aliasAttrs.length === 0) { aliasAttrs = undefined; }\n    } else {\n      usernameAttrs = [];\n      if (signIn.email) { usernameAttrs.push(StandardAttributeNames.email); }\n      if (signIn.phone) { usernameAttrs.push(StandardAttributeNames.phoneNumber); }\n    }\n\n    if (props.autoVerify) {\n      autoVerifyAttrs = [];\n      if (props.autoVerify.email) { autoVerifyAttrs.push(StandardAttributeNames.email); }\n      if (props.autoVerify.phone) { autoVerifyAttrs.push(StandardAttributeNames.phoneNumber); }\n    } else if (signIn.email || signIn.phone) {\n      autoVerifyAttrs = [];\n      if (signIn.email) { autoVerifyAttrs.push(StandardAttributeNames.email); }\n      if (signIn.phone) { autoVerifyAttrs.push(StandardAttributeNames.phoneNumber); }\n    }\n\n    return { usernameAttrs, aliasAttrs, autoVerifyAttrs };\n  }\n\n  private smsConfiguration(props: UserPoolProps): CfnUserPool.SmsConfigurationProperty | undefined {\n    if (props.enableSmsRole === false && props.smsRole) {\n      throw new Error('enableSmsRole cannot be disabled when smsRole is specified');\n    }\n\n    if (props.smsRole) {\n      return {\n        snsCallerArn: props.smsRole.roleArn,\n        externalId: props.smsRoleExternalId,\n        snsRegion: props.snsRegion,\n      };\n    }\n\n    if (props.enableSmsRole === false) {\n      return undefined;\n    }\n\n    const mfaConfiguration = this.mfaConfiguration(props);\n    const phoneVerification = props.signInAliases?.phone === true || props.autoVerify?.phone === true;\n    const roleRequired = mfaConfiguration?.includes('SMS_MFA') || phoneVerification;\n    if (!roleRequired && props.enableSmsRole === undefined) {\n      return undefined;\n    }\n\n    const smsRoleExternalId = Names.uniqueId(this).slice(0, 1223); // sts:ExternalId max length of 1224\n    const smsRole = props.smsRole ?? new Role(this, 'smsRole', {\n      assumedBy: new ServicePrincipal('cognito-idp.amazonaws.com', {\n        conditions: {\n          StringEquals: { 'sts:ExternalId': smsRoleExternalId },\n        },\n      }),\n      inlinePolicies: {\n        /*\n          * The UserPool is very particular that it must contain an 'sns:Publish' action as an inline policy.\n          * Ideally, a conditional that restricts this action to 'sms' protocol needs to be attached, but the UserPool deployment fails validation.\n          * Seems like a case of being excessively strict.\n          */\n        'sns-publish': new PolicyDocument({\n          statements: [\n            new PolicyStatement({\n              actions: ['sns:Publish'],\n              resources: ['*'],\n            }),\n          ],\n        }),\n      },\n    });\n    return {\n      externalId: smsRoleExternalId,\n      snsCallerArn: smsRole.roleArn,\n      snsRegion: props.snsRegion,\n    };\n  }\n\n  private mfaConfiguration(props: UserPoolProps): string[] | undefined {\n    if (props.mfa === undefined || props.mfa === Mfa.OFF) {\n      // since default is OFF, treat undefined and OFF the same way\n      return undefined;\n    } else if (props.mfaSecondFactor === undefined &&\n      (props.mfa === Mfa.OPTIONAL || props.mfa === Mfa.REQUIRED)) {\n      return ['SMS_MFA'];\n    } else {\n      const enabledMfas = [];\n      if (props.mfaSecondFactor!.sms) {\n        enabledMfas.push('SMS_MFA');\n      }\n      if (props.mfaSecondFactor!.otp) {\n        enabledMfas.push('SOFTWARE_TOKEN_MFA');\n      }\n      return enabledMfas;\n    }\n  }\n\n  private configurePasswordPolicy(props: UserPoolProps): CfnUserPool.PasswordPolicyProperty | undefined {\n    const tempPasswordValidity = props.passwordPolicy?.tempPasswordValidity;\n    if (tempPasswordValidity !== undefined && tempPasswordValidity.toDays() > Duration.days(365).toDays()) {\n      throw new Error(`tempPasswordValidity cannot be greater than 365 days (received: ${tempPasswordValidity.toDays()})`);\n    }\n    const minLength = props.passwordPolicy ? props.passwordPolicy.minLength ?? 8 : undefined;\n    if (minLength !== undefined && (minLength < 6 || minLength > 99)) {\n      throw new Error(`minLength for password must be between 6 and 99 (received: ${minLength})`);\n    }\n    return undefinedIfNoKeys({\n      temporaryPasswordValidityDays: tempPasswordValidity?.toDays({ integral: true }),\n      minimumLength: minLength,\n      requireLowercase: props.passwordPolicy?.requireLowercase,\n      requireUppercase: props.passwordPolicy?.requireUppercase,\n      requireNumbers: props.passwordPolicy?.requireDigits,\n      requireSymbols: props.passwordPolicy?.requireSymbols,\n    });\n  }\n\n  private schemaConfiguration(props: UserPoolProps): CfnUserPool.SchemaAttributeProperty[] | undefined {\n    const schema: CfnUserPool.SchemaAttributeProperty[] = [];\n\n    if (props.standardAttributes) {\n      const stdAttributes = (Object.entries(props.standardAttributes) as Array<[keyof StandardAttributes, StandardAttribute]>)\n        .filter(([, attr]) => !!attr)\n        .map(([attrName, attr]) => ({\n          name: StandardAttributeNames[attrName],\n          mutable: attr.mutable ?? true,\n          required: attr.required ?? false,\n        }));\n\n      schema.push(...stdAttributes);\n    }\n\n    if (props.customAttributes) {\n      const customAttrs = Object.keys(props.customAttributes).map((attrName) => {\n        const attrConfig = props.customAttributes![attrName].bind();\n        const numberConstraints: CfnUserPool.NumberAttributeConstraintsProperty = {\n          minValue: attrConfig.numberConstraints?.min?.toString(),\n          maxValue: attrConfig.numberConstraints?.max?.toString(),\n        };\n        const stringConstraints: CfnUserPool.StringAttributeConstraintsProperty = {\n          minLength: attrConfig.stringConstraints?.minLen?.toString(),\n          maxLength: attrConfig.stringConstraints?.maxLen?.toString(),\n        };\n\n        return {\n          name: attrName,\n          attributeDataType: attrConfig.dataType,\n          numberAttributeConstraints: attrConfig.numberConstraints\n            ? numberConstraints\n            : undefined,\n          stringAttributeConstraints: attrConfig.stringConstraints\n            ? stringConstraints\n            : undefined,\n          mutable: attrConfig.mutable,\n        };\n      });\n      schema.push(...customAttrs);\n    }\n\n    if (schema.length === 0) {\n      return undefined;\n    }\n    return schema;\n  }\n\n  private accountRecovery(props: UserPoolProps): undefined | CfnUserPool.AccountRecoverySettingProperty {\n    const accountRecovery = props.accountRecovery ?? AccountRecovery.PHONE_WITHOUT_MFA_AND_EMAIL;\n    switch (accountRecovery) {\n      case AccountRecovery.EMAIL_AND_PHONE_WITHOUT_MFA:\n        return {\n          recoveryMechanisms: [\n            { name: 'verified_email', priority: 1 },\n            { name: 'verified_phone_number', priority: 2 },\n          ],\n        };\n      case AccountRecovery.PHONE_WITHOUT_MFA_AND_EMAIL:\n        return {\n          recoveryMechanisms: [\n            { name: 'verified_phone_number', priority: 1 },\n            { name: 'verified_email', priority: 2 },\n          ],\n        };\n      case AccountRecovery.EMAIL_ONLY:\n        return {\n          recoveryMechanisms: [{ name: 'verified_email', priority: 1 }],\n        };\n      case AccountRecovery.PHONE_ONLY_WITHOUT_MFA:\n        return {\n          recoveryMechanisms: [{ name: 'verified_phone_number', priority: 1 }],\n        };\n      case AccountRecovery.NONE:\n        return {\n          recoveryMechanisms: [{ name: 'admin_only', priority: 1 }],\n        };\n      case AccountRecovery.PHONE_AND_EMAIL:\n        return undefined;\n      default:\n        throw new Error(`Unsupported AccountRecovery type - ${accountRecovery}`);\n    }\n  }\n}\n\nfunction undefinedIfNoKeys(struct: object): object | undefined {\n  const allUndefined = Object.values(struct).every(val => val === undefined);\n  return allUndefined ? undefined : struct;\n}\nfunction encodePuny(input: string | undefined): string | undefined {\n  return input !== undefined ? punycodeEncode(input) : input;\n}\n"],
  "mappings": "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",
  "names": []
}
