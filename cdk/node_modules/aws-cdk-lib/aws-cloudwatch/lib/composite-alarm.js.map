{
  "version": 3,
  "sources": ["composite-alarm.ts"],
  "sourcesContent": ["import { ArnFormat, Lazy, Names, Stack } from '../../core';\nimport { Construct } from 'constructs';\nimport { AlarmBase, IAlarm, IAlarmRule } from './alarm-base';\nimport { CfnCompositeAlarm } from './cloudwatch.generated';\n\n/**\n * Properties for creating a Composite Alarm\n */\nexport interface CompositeAlarmProps {\n\n  /**\n   * Whether the actions for this alarm are enabled\n   *\n   * @default true\n   */\n  readonly actionsEnabled?: boolean;\n\n  /**\n   * Description for the alarm\n   *\n   * @default No description\n   */\n  readonly alarmDescription?: string;\n\n  /**\n   * Name of the alarm\n   *\n   * @default Automatically generated name\n   */\n  readonly compositeAlarmName?: string;\n\n  /**\n   * Expression that specifies which other alarms are to be evaluated to determine this composite alarm's state.\n   */\n  readonly alarmRule: IAlarmRule;\n\n}\n\n/**\n * A Composite Alarm based on Alarm Rule.\n */\nexport class CompositeAlarm extends AlarmBase {\n\n  /**\n   * Import an existing CloudWatch composite alarm provided an Name.\n   *\n   * @param scope The parent creating construct (usually `this`)\n   * @param id The construct's name\n   * @param compositeAlarmName Composite Alarm Name\n   */\n  public static fromCompositeAlarmName(scope: Construct, id: string, compositeAlarmName: string): IAlarm {\n    const stack = Stack.of(scope);\n\n    return this.fromCompositeAlarmArn(scope, id, stack.formatArn({\n      service: 'cloudwatch',\n      resource: 'alarm',\n      resourceName: compositeAlarmName,\n    }));\n  }\n\n  /**\n   * Import an existing CloudWatch composite alarm provided an ARN.\n   *\n   * @param scope The parent creating construct (usually `this`)\n   * @param id The construct's name\n   * @param compositeAlarmArn Composite Alarm ARN (i.e. arn:aws:cloudwatch:<region>:<account-id>:alarm/CompositeAlarmName)\n   */\n  public static fromCompositeAlarmArn(scope: Construct, id: string, compositeAlarmArn: string): IAlarm {\n    class Import extends AlarmBase implements IAlarm {\n      public readonly alarmArn = compositeAlarmArn;\n      public readonly alarmName = Stack.of(scope).splitArn(compositeAlarmArn, ArnFormat.SLASH_RESOURCE_NAME).resourceName!;\n    }\n    return new Import(scope, id);\n  }\n\n  /**\n   * ARN of this alarm\n   *\n   * @attribute\n   */\n  public readonly alarmArn: string;\n\n  /**\n   * Name of this alarm.\n   *\n   * @attribute\n   */\n  public readonly alarmName: string;\n\n  private readonly alarmRule: string;\n\n  constructor(scope: Construct, id: string, props: CompositeAlarmProps) {\n    super(scope, id, {\n      physicalName: props.compositeAlarmName ?? Lazy.string({ produce: () => this.generateUniqueId() }),\n    });\n\n    if (props.alarmRule.renderAlarmRule().length > 10240) {\n      throw new Error('Alarm Rule expression cannot be greater than 10240 characters, please reduce the conditions in the Alarm Rule');\n    }\n\n    this.alarmRule = props.alarmRule.renderAlarmRule();\n\n    const alarm = new CfnCompositeAlarm(this, 'Resource', {\n      alarmName: this.physicalName,\n      alarmRule: this.alarmRule,\n      alarmDescription: props.alarmDescription,\n      actionsEnabled: props.actionsEnabled,\n      alarmActions: Lazy.list({ produce: () => this.alarmActionArns }),\n      insufficientDataActions: Lazy.list({ produce: (() => this.insufficientDataActionArns) }),\n      okActions: Lazy.list({ produce: () => this.okActionArns }),\n    });\n\n    this.alarmName = this.getResourceNameAttribute(alarm.ref);\n    this.alarmArn = this.getResourceArnAttribute(alarm.attrArn, {\n      service: 'cloudwatch',\n      resource: 'alarm',\n      resourceName: this.physicalName,\n      arnFormat: ArnFormat.COLON_RESOURCE_NAME,\n    });\n\n  }\n\n  private generateUniqueId(): string {\n    const name = Names.uniqueId(this);\n    if (name.length > 240) {\n      return name.substring(0, 120) + name.substring(name.length - 120);\n    }\n    return name;\n  }\n\n}\n"],
  "mappings": "qNAAA,OAAA,QAAA,YAAA,EAEA,aAAA,QAAA,cAAA,EACA,uBAAA,QAAA,wBAAA,EAsCA,MAAa,sBAAuB,cAAA,SAAS,CAkD3C,YAAY,MAAkB,GAAY,MAA0B,QAClE,MAAM,MAAO,GAAI,CACf,aAAY,IAAE,MAAM,sBAAkB,MAAA,KAAA,OAAA,GAAI,OAAA,KAAK,OAAO,CAAE,QAAS,IAAM,KAAK,iBAAgB,CAAE,CAAE,EACjG,EAED,iFAAI,MAAM,UAAU,gBAAe,EAAG,OAAS,MAC7C,KAAM,IAAI,OAAM,+GAA+G,EAGjI,KAAK,UAAY,MAAM,UAAU,gBAAe,EAEhD,KAAM,OAAQ,GAAI,wBAAA,kBAAkB,KAAM,WAAY,CACpD,UAAW,KAAK,aAChB,UAAW,KAAK,UAChB,iBAAkB,MAAM,iBACxB,eAAgB,MAAM,eACtB,aAAc,OAAA,KAAK,KAAK,CAAE,QAAS,IAAM,KAAK,eAAe,CAAE,EAC/D,wBAAyB,OAAA,KAAK,KAAK,CAAE,QAAU,IAAM,KAAK,0BAA2B,CAAE,EACvF,UAAW,OAAA,KAAK,KAAK,CAAE,QAAS,IAAM,KAAK,YAAY,CAAE,EAC1D,EAED,KAAK,UAAY,KAAK,yBAAyB,MAAM,GAAG,EACxD,KAAK,SAAW,KAAK,wBAAwB,MAAM,QAAS,CAC1D,QAAS,aACT,SAAU,QACV,aAAc,KAAK,aACnB,UAAW,OAAA,UAAU,oBACtB,QApEW,wBAAuB,MAAkB,GAAY,mBAA0B,CAC3F,KAAM,OAAQ,OAAA,MAAM,GAAG,KAAK,EAE5B,MAAO,MAAK,sBAAsB,MAAO,GAAI,MAAM,UAAU,CAC3D,QAAS,aACT,SAAU,QACV,aAAc,mBACf,CAAC,QAUU,uBAAsB,MAAkB,GAAY,kBAAyB,CACzF,MAAM,cAAe,cAAA,SAAS,CAA9B,aAAA,qBACkB,KAAA,SAAW,kBACX,KAAA,UAAY,OAAA,MAAM,GAAG,KAAK,EAAE,SAAS,kBAAmB,OAAA,UAAU,mBAAmB,EAAE,YACzG,EACA,MAAO,IAAI,QAAO,MAAO,EAAE,EAkDrB,kBAAgB,CACtB,KAAM,MAAO,OAAA,MAAM,SAAS,IAAI,EAChC,MAAI,MAAK,OAAS,IACT,KAAK,UAAU,EAAG,GAAG,EAAI,KAAK,UAAU,KAAK,OAAS,GAAG,EAE3D,MAtFX,QAAA,eAAA",
  "names": []
}
