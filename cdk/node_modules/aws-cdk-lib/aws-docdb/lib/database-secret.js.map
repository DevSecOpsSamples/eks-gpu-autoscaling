{
  "version": 3,
  "sources": ["database-secret.ts"],
  "sourcesContent": ["import { IKey } from '../../aws-kms';\nimport { ISecret, Secret } from '../../aws-secretsmanager';\nimport { Aws } from '../../core';\nimport { Construct } from 'constructs';\n\n/**\n * Construction properties for a DatabaseSecret.\n */\nexport interface DatabaseSecretProps {\n  /**\n   * The username.\n   */\n  readonly username: string;\n\n  /**\n   * The KMS key to use to encrypt the secret.\n   *\n   * @default default master key\n   */\n  readonly encryptionKey?: IKey;\n\n  /**\n   * The physical name of the secret\n   *\n   * @default Secretsmanager will generate a physical name for the secret\n   */\n  readonly secretName?: string;\n\n  /**\n   * The master secret which will be used to rotate this secret.\n   *\n   * @default - no master secret information will be included\n   */\n  readonly masterSecret?: ISecret;\n\n  /**\n   * Characters to not include in the generated password.\n   *\n   * @default \"\\\"@/\"\n   */\n  readonly excludeCharacters?: string;\n}\n\n/**\n *\n * A database secret.\n *\n * @resource AWS::SecretsManager::Secret\n */\nexport class DatabaseSecret extends Secret {\n\n  /**\n   * the excluded characters for this Secret\n   * @internal\n   */\n  public readonly _excludedCharacters: string;\n\n  constructor(scope: Construct, id: string, props: DatabaseSecretProps) {\n    const excludedCharacters = props.excludeCharacters ?? '\"@/';\n\n    super(scope, id, {\n      secretName: props.secretName,\n      description: `Generated by the CDK for stack: ${Aws.STACK_NAME}`,\n      encryptionKey: props.encryptionKey,\n      // The CloudFormation resource provider for AWS::DocDB::DBCluster currently limits the DocDB master password to\n      // 41 characters when pulling the password from secrets manager using a CloudFormation reference. This does not\n      // line up with the CloudFormation resource specification which states a maximum of 100 characters:\n      //\n      // https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-docdb-dbcluster.html#cfn-docdb-dbcluster-masteruserpassword\n      //\n      // When attempting to exceed 41 characters, a deployment fails with the message:\n      // Length of value for property {/MasterUserPassword} is greater than maximum allowed length {41}\n      generateSecretString: {\n        passwordLength: 41,\n        secretStringTemplate: JSON.stringify({\n          username: props.username,\n          masterarn: props.masterSecret?.secretArn,\n        }),\n        generateStringKey: 'password',\n        excludeCharacters: excludedCharacters,\n      },\n    });\n\n    this._excludedCharacters = excludedCharacters;\n  }\n}\n"],
  "mappings": "qNACA,qBAAA,QAAA,0BAAA,EACA,OAAA,QAAA,YAAA,EA+CA,MAAa,sBAAuB,sBAAA,MAAM,CAQxC,YAAY,MAAkB,GAAY,MAA0B,oFAClE,KAAM,oBAAkB,IAAG,MAAM,qBAAiB,MAAA,KAAA,OAAA,GAAI,MAEtD,MAAM,MAAO,GAAI,CACf,WAAY,MAAM,WAClB,YAAa,mCAAmC,OAAA,IAAI,aACpD,cAAe,MAAM,cASrB,qBAAsB,CACpB,eAAgB,GAChB,qBAAsB,KAAK,UAAU,CACnC,SAAU,MAAM,SAChB,UAAS,IAAE,MAAM,gBAAY,MAAA,KAAA,OAAA,OAAA,GAAE,UAChC,EACD,kBAAmB,WACnB,kBAAmB,oBAEtB,EAED,KAAK,oBAAsB,oBAlC/B,QAAA,eAAA",
  "names": []
}
