{
  "version": 3,
  "sources": ["lambda-hook.ts"],
  "sourcesContent": ["import * as autoscaling from '../../aws-autoscaling';\nimport * as kms from '../../aws-kms';\nimport * as lambda from '../../aws-lambda';\nimport * as sns from '../../aws-sns';\nimport * as subs from '../../aws-sns-subscriptions';\n\nimport { createRole } from './common';\nimport { TopicHook } from './topic-hook';\n\n// keep this import separate from other imports to reduce chance for merge conflicts with v2-main\n// eslint-disable-next-line no-duplicate-imports, import/order\nimport { Construct } from 'constructs';\n\n/**\n * Use a Lambda Function as a hook target\n *\n * Internally creates a Topic to make the connection.\n */\nexport class FunctionHook implements autoscaling.ILifecycleHookTarget {\n  /**\n   * @param fn Function to invoke in response to a lifecycle event\n   * @param encryptionKey If provided, this key is used to encrypt the contents of the SNS topic.\n   */\n  constructor(private readonly fn: lambda.IFunction, private readonly encryptionKey?: kms.IKey) {\n  }\n\n  /**\n   * If the `IRole` does not exist in `options`, will create an `IRole` and an SNS Topic and attach both to the lifecycle hook.\n   * If the `IRole` does exist in `options`, will only create an SNS Topic and attach it to the lifecycle hook.\n   */\n  public bind(_scope: Construct, options: autoscaling.BindHookTargetOptions): autoscaling.LifecycleHookTargetConfig {\n    const topic = new sns.Topic(_scope, 'Topic', {\n      masterKey: this.encryptionKey,\n    });\n\n    const role = createRole(_scope, options.role);\n\n    // Per: https://docs.aws.amazon.com/sns/latest/dg/sns-key-management.html#sns-what-permissions-for-sse\n    // Topic's grantPublish() is in a base class that does not know there is a kms key, and so does not\n    // grant appropriate permissions to the kms key. We do that here to ensure the correct permissions\n    // are in place.\n    this.encryptionKey?.grant(role, 'kms:Decrypt', 'kms:GenerateDataKey');\n    topic.addSubscription(new subs.LambdaSubscription(this.fn));\n    return new TopicHook(topic).bind(_scope, { lifecycleHook: options.lifecycleHook, role });\n  }\n}\n"],
  "mappings": "mNAGA,IAAA,QAAA,eAAA,EACA,KAAA,QAAA,6BAAA,EAEA,SAAA,QAAA,UAAA,EACA,aAAA,QAAA,cAAA,EAWA,MAAa,YAAY,CAKvB,YAA6B,GAAuC,cAAwB,CAA/D,KAAA,GAAA,GAAuC,KAAA,cAAA,2IAO7D,KAAK,OAAmB,QAA0C,2FACvE,KAAM,OAAQ,GAAI,KAAI,MAAM,OAAQ,QAAS,CAC3C,UAAW,KAAK,cACjB,EAEK,KAAO,SAAA,WAAW,OAAQ,QAAQ,IAAI,EAM5C,MAAA,IAAA,KAAK,iBAAa,MAAA,KAAA,QAAA,GAAE,MAAM,KAAM,cAAe,qBAAqB,EACpE,MAAM,gBAAgB,GAAI,MAAK,mBAAmB,KAAK,EAAE,CAAC,EACnD,GAAI,cAAA,UAAU,KAAK,EAAE,KAAK,OAAQ,CAAE,cAAe,QAAQ,cAAe,IAAI,CAAE,GAzB3F,QAAA,aAAA",
  "names": []
}
