"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.LambdaIntegration=void 0;const jsiiDeprecationWarnings=require("../../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),iam=require("../../../aws-iam"),lambda=require("../../../aws-lambda"),core_1=require("../../../core"),aws_1=require("./aws");class LambdaIntegration extends aws_1.AwsIntegration{constructor(handler,options={}){var _b,_c;jsiiDeprecationWarnings.aws_cdk_lib_aws_lambda_IFunction(handler),jsiiDeprecationWarnings.aws_cdk_lib_aws_apigateway_LambdaIntegrationOptions(options);const proxy=(_b=options.proxy)!==null&&_b!==void 0?_b:!0;super({proxy,service:"lambda",path:`2015-03-31/functions/${handler.functionArn}/invocations`,options});this.handler=handler,this.enableTest=(_c=options.allowTestInvoke)!==null&&_c!==void 0?_c:!0}bind(method){jsiiDeprecationWarnings.aws_cdk_lib_aws_apigateway_Method(method);const bindResult=super.bind(method),principal=new iam.ServicePrincipal("apigateway.amazonaws.com"),desc=`${core_1.Names.nodeUniqueId(method.api.node)}.${method.httpMethod}.${method.resource.path.replace(/\//g,".")}`;this.handler.addPermission(`ApiPermission.${desc}`,{principal,scope:method,sourceArn:core_1.Lazy.string({produce:()=>method.methodArn})}),this.enableTest&&this.handler.addPermission(`ApiPermission.Test.${desc}`,{principal,scope:method,sourceArn:method.testMethodArn});let functionName;this.handler instanceof lambda.Function?functionName=this.handler.node.defaultChild.functionName:functionName=this.handler.functionName;let deploymentToken;return core_1.Token.isUnresolved(functionName)||(deploymentToken=JSON.stringify({functionName})),{...bindResult,deploymentToken}}}exports.LambdaIntegration=LambdaIntegration,_a=JSII_RTTI_SYMBOL_1,LambdaIntegration[_a]={fqn:"aws-cdk-lib.aws_apigateway.LambdaIntegration",version:"2.20.0"};
//# sourceMappingURL=lambda.js.map
