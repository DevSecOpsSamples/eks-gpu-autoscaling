{
  "version": 3,
  "sources": ["integ.request-authorizer.lit.ts"],
  "sourcesContent": ["/// !cdk-integ pragma:ignore-assets\nimport * as path from 'path';\nimport * as lambda from '../../../aws-lambda';\nimport { App, Stack } from '../../../core';\nimport { MockIntegration, PassthroughBehavior, RestApi } from '../../lib';\nimport { RequestAuthorizer } from '../../lib/authorizers';\nimport { IdentitySource } from '../../lib/authorizers/identity-source';\n\n// Against the RestApi endpoint from the stack output, run\n// `curl -s -o /dev/null -w \"%{http_code}\" <url>` should return 401\n// `curl -s -o /dev/null -w \"%{http_code}\" -H 'Authorization: deny' <url>?allow=yes` should return 403\n// `curl -s -o /dev/null -w \"%{http_code}\" -H 'Authorization: allow' <url>?allow=yes` should return 200\n\nconst app = new App();\nconst stack = new Stack(app, 'RequestAuthorizerInteg');\n\nconst authorizerFn = new lambda.Function(stack, 'MyAuthorizerFunction', {\n  runtime: lambda.Runtime.NODEJS_14_X,\n  handler: 'index.handler',\n  code: lambda.AssetCode.fromAsset(path.join(__dirname, 'integ.request-authorizer.handler')),\n});\n\nconst restapi = new RestApi(stack, 'MyRestApi');\n\nconst authorizer = new RequestAuthorizer(stack, 'MyAuthorizer', {\n  handler: authorizerFn,\n  identitySources: [IdentitySource.header('Authorization'), IdentitySource.queryString('allow')],\n});\n\nrestapi.root.addMethod('ANY', new MockIntegration({\n  integrationResponses: [\n    { statusCode: '200' },\n  ],\n  passthroughBehavior: PassthroughBehavior.NEVER,\n  requestTemplates: {\n    'application/json': '{ \"statusCode\": 200 }',\n  },\n}), {\n  methodResponses: [\n    { statusCode: '200' },\n  ],\n  authorizer,\n});\n"],
  "mappings": "oEACA,KAAA,MAAA,QAAA,MAAA,EACA,OAAA,QAAA,qBAAA,EACA,OAAA,QAAA,eAAA,EACA,MAAA,QAAA,WAAA,EACA,cAAA,QAAA,uBAAA,EACA,kBAAA,QAAA,uCAAA,EAOM,IAAM,GAAI,QAAA,IACV,MAAQ,GAAI,QAAA,MAAM,IAAK,wBAAwB,EAE/C,aAAe,GAAI,QAAO,SAAS,MAAO,uBAAwB,CACtE,QAAS,OAAO,QAAQ,YACxB,QAAS,gBACT,KAAM,OAAO,UAAU,UAAU,KAAK,KAAK,UAAW,kCAAkC,CAAC,EAC1F,EAEK,QAAU,GAAI,OAAA,QAAQ,MAAO,WAAW,EAExC,WAAa,GAAI,eAAA,kBAAkB,MAAO,eAAgB,CAC9D,QAAS,aACT,gBAAiB,CAAC,kBAAA,eAAe,OAAO,eAAe,EAAG,kBAAA,eAAe,YAAY,OAAO,CAAC,EAC9F,EAED,QAAQ,KAAK,UAAU,MAAO,GAAI,OAAA,gBAAgB,CAChD,qBAAsB,CACpB,CAAE,WAAY,KAAK,GAErB,oBAAqB,MAAA,oBAAoB,MACzC,iBAAkB,CAChB,mBAAoB,yBAEvB,EAAG,CACF,gBAAiB,CACf,CAAE,WAAY,KAAK,GAErB,WACD",
  "names": []
}
