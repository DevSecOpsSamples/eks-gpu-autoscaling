"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.VirtualGateway=void 0;const jsiiDeprecationWarnings=require("../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),iam=require("../../aws-iam"),cdk=require("../../core"),appmesh_generated_1=require("./appmesh.generated"),gateway_route_1=require("./gateway-route"),mesh_1=require("./mesh"),utils_1=require("./private/utils"),virtual_gateway_listener_1=require("./virtual-gateway-listener");class VirtualGatewayBase extends cdk.Resource{addGatewayRoute(id,props){return new gateway_route_1.GatewayRoute(this,id,{...props,virtualGateway:this})}grantStreamAggregatedResources(identity){return iam.Grant.addToPrincipal({grantee:identity,actions:["appmesh:StreamAggregatedResources"],resourceArns:[this.virtualGatewayArn]})}}class VirtualGateway extends VirtualGatewayBase{constructor(scope,id,props){var _b,_c;super(scope,id,{physicalName:props.virtualGatewayName||cdk.Lazy.string({produce:()=>cdk.Names.uniqueId(this)})});this.listeners=new Array,jsiiDeprecationWarnings.aws_cdk_lib_aws_appmesh_VirtualGatewayProps(props),this.mesh=props.mesh,props.listeners?props.listeners.forEach(listener=>this.listeners.push(listener.bind(this))):this.listeners.push(virtual_gateway_listener_1.VirtualGatewayListener.http().bind(this));const accessLogging=(_b=props.accessLog)===null||_b===void 0?void 0:_b.bind(this),node=new appmesh_generated_1.CfnVirtualGateway(this,"Resource",{virtualGatewayName:this.physicalName,meshName:this.mesh.meshName,meshOwner:utils_1.renderMeshOwner(this.env.account,this.mesh.env.account),spec:{listeners:this.listeners.map(listener=>listener.listener),backendDefaults:props.backendDefaults!==void 0?{clientPolicy:{tls:utils_1.renderTlsClientPolicy(this,(_c=props.backendDefaults)===null||_c===void 0?void 0:_c.tlsClientPolicy)}}:void 0,logging:accessLogging!==void 0?{accessLog:accessLogging.virtualGatewayAccessLog}:void 0}});this.virtualGatewayName=this.getResourceNameAttribute(node.attrVirtualGatewayName),this.virtualGatewayArn=this.getResourceArnAttribute(node.ref,{service:"appmesh",resource:`mesh/${props.mesh.meshName}/virtualGateway`,resourceName:this.physicalName})}static fromVirtualGatewayArn(scope,id,virtualGatewayArn){return new class extends VirtualGatewayBase{constructor(){super(...arguments);this.parsedArn=cdk.Fn.split("/",cdk.Stack.of(scope).splitArn(virtualGatewayArn,cdk.ArnFormat.SLASH_RESOURCE_NAME).resourceName),this.mesh=mesh_1.Mesh.fromMeshName(this,"Mesh",cdk.Fn.select(0,this.parsedArn)),this.virtualGatewayArn=virtualGatewayArn,this.virtualGatewayName=cdk.Fn.select(2,this.parsedArn)}}(scope,id)}static fromVirtualGatewayAttributes(scope,id,attrs){return jsiiDeprecationWarnings.aws_cdk_lib_aws_appmesh_VirtualGatewayAttributes(attrs),new class extends VirtualGatewayBase{constructor(){super(...arguments);this.mesh=attrs.mesh,this.virtualGatewayName=attrs.virtualGatewayName,this.virtualGatewayArn=cdk.Stack.of(this).formatArn({service:"appmesh",resource:`mesh/${attrs.mesh.meshName}/virtualGateway`,resourceName:this.virtualGatewayName})}}(scope,id)}}exports.VirtualGateway=VirtualGateway,_a=JSII_RTTI_SYMBOL_1,VirtualGateway[_a]={fqn:"aws-cdk-lib.aws_appmesh.VirtualGateway",version:"2.20.0"};
//# sourceMappingURL=virtual-gateway.js.map
