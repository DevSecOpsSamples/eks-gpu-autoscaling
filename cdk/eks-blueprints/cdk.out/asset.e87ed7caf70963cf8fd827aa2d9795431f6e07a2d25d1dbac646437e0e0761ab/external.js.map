{
  "version": 3,
  "sources": ["external.ts"],
  "sourcesContent": ["/* istanbul ignore file */\n\nimport * as tls from 'tls';\nimport * as url from 'url';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport * as aws from 'aws-sdk';\n\nlet client: aws.IAM;\n\nfunction iam() {\n  if (!client) { client = new aws.IAM(); }\n  return client;\n}\n\nfunction defaultLogger(fmt: string, ...args: any[]) {\n  // eslint-disable-next-line no-console\n  console.log(fmt, ...args);\n}\n\n/**\n * Downloads the CA thumbprint from the issuer URL\n */\nasync function downloadThumbprint(issuerUrl: string) {\n  external.log(`downloading certificate authority thumbprint for ${issuerUrl}`);\n  return new Promise<string>((ok, ko) => {\n    const purl = url.parse(issuerUrl);\n    const port = purl.port ? parseInt(purl.port, 10) : 443;\n    if (!purl.host) {\n      return ko(new Error(`unable to determine host from issuer url ${issuerUrl}`));\n    }\n    const socket = tls.connect(port, purl.host, { rejectUnauthorized: false, servername: purl.host });\n    socket.once('error', ko);\n    socket.once('secureConnect', () => {\n      const cert = socket.getPeerCertificate();\n      socket.end();\n      const thumbprint = cert.fingerprint.split(':').join('');\n      external.log(`certificate authority thumbprint for ${issuerUrl} is ${thumbprint}`);\n      ok(thumbprint);\n    });\n  });\n}\n\n// allows unit test to replace with mocks\n/* eslint-disable max-len */\nexport const external = {\n  downloadThumbprint,\n  log: defaultLogger,\n  createOpenIDConnectProvider: (req: aws.IAM.CreateOpenIDConnectProviderRequest) => iam().createOpenIDConnectProvider(req).promise(),\n  deleteOpenIDConnectProvider: (req: aws.IAM.DeleteOpenIDConnectProviderRequest) => iam().deleteOpenIDConnectProvider(req).promise(),\n  updateOpenIDConnectProviderThumbprint: (req: aws.IAM.UpdateOpenIDConnectProviderThumbprintRequest) => iam().updateOpenIDConnectProviderThumbprint(req).promise(),\n  addClientIDToOpenIDConnectProvider: (req: aws.IAM.AddClientIDToOpenIDConnectProviderRequest) => iam().addClientIDToOpenIDConnectProvider(req).promise(),\n  removeClientIDFromOpenIDConnectProvider: (req: aws.IAM.RemoveClientIDFromOpenIDConnectProviderRequest) => iam().removeClientIDFromOpenIDConnectProvider(req).promise(),\n};\n"],
  "mappings": "4FAEA,KAAA,KAAA,QAAA,KAAA,EACA,IAAA,QAAA,KAAA,EAEA,IAAA,QAAA,SAAA,EAEA,GAAI,QAEJ,cAAY,CACV,MAAK,SAAU,QAAS,GAAI,KAAI,KACzB,MACT,CAEA,uBAAuB,OAAgB,KAAW,CAEhD,QAAQ,IAAI,IAAK,GAAG,IAAI,CAC1B,CAKA,kCAAkC,UAAiB,CACjD,eAAA,SAAS,IAAI,oDAAoD,WAAW,EACrE,GAAI,SAAgB,CAAC,GAAI,KAAM,CACpC,KAAM,MAAO,IAAI,MAAM,SAAS,EAC1B,KAAO,KAAK,KAAO,SAAS,KAAK,KAAM,EAAE,EAAI,IACnD,GAAI,CAAC,KAAK,KACR,MAAO,IAAG,GAAI,OAAM,4CAA4C,WAAW,CAAC,EAE9E,KAAM,QAAS,IAAI,QAAQ,KAAM,KAAK,KAAM,CAAE,mBAAoB,GAAO,WAAY,KAAK,IAAI,CAAE,EAChG,OAAO,KAAK,QAAS,EAAE,EACvB,OAAO,KAAK,gBAAiB,IAAK,CAChC,KAAM,MAAO,OAAO,mBAAkB,EACtC,OAAO,IAAG,EACV,KAAM,YAAa,KAAK,YAAY,MAAM,GAAG,EAAE,KAAK,EAAE,EACtD,QAAA,SAAS,IAAI,wCAAwC,gBAAgB,YAAY,EACjF,GAAG,UAAU,CACf,CAAC,CACH,CAAC,CACH,CAIa,QAAA,SAAW,CACtB,mBACA,IAAK,cACL,4BAA6B,AAAC,KAAoD,IAAG,EAAG,4BAA4B,GAAG,EAAE,QAAO,EAChI,4BAA6B,AAAC,KAAoD,IAAG,EAAG,4BAA4B,GAAG,EAAE,QAAO,EAChI,sCAAuC,AAAC,KAA8D,IAAG,EAAG,sCAAsC,GAAG,EAAE,QAAO,EAC9J,mCAAoC,AAAC,KAA2D,IAAG,EAAG,mCAAmC,GAAG,EAAE,QAAO,EACrJ,wCAAyC,AAAC,KAAgE,IAAG,EAAG,wCAAwC,GAAG,EAAE,QAAO",
  "names": []
}
