# # gpu-hpa.yaml
# apiVersion: autoscaling/v2beta1
# kind: HorizontalPodAutoscaler
# metadata:
#   name: hpa-gpu-ml-api
#   namespace: default
# spec:
#   scaleTargetRef:
#     apiVersion: apps/v1beta1
#     kind: Deployment
#     name: vision-api
#   minReplicas: 1
#   maxReplicas: 30
#   metrics:
#   - type: Object
#     object:
#       target:
#         kind: Service
#         # name: dcgm-exporter
#         name: dcgm-exporter
#       metricName: DCGM_FI_DEV_GPU_UTIL
#       targetValue: 25

#   metrics: 
#   - type: Resource
#     resource:
#       name: cpu 
#       target:
#         type: AverageValue 
#         averageValue: 500m 

# apiVersion: autoscaling/v2beta1
# kind: HorizontalPodAutoscaler
# metadata:
#   name: custom-metric-sd
#   namespace: default
# spec:
#   scaleTargetRef:
#     apiVersion: apps/v1beta1
#     kind: Deployment
#     name: custom-metric-sd
#   minReplicas: 1
#   maxReplicas: 5
#   metrics:
#   - type: Pods
#     pods:
#       metricName: foo
#       targetAverageValue: 20

#   # - type: External
#   #   external:
#   #     metricName: DCGM_FI_DEV_GPU_UTIL
#   #     targetAverageValue: 20
#   # - type: Object
#   #   object:
#   #     # metric: DCGM_FI_DEV_GPU_UTIL
#   #     target:
#   #       metricName: DCGM_FI_DEV_GPU_UTIL
#   #       targetValue: 20
#   #     # target: 20
  
# spec:
#   metrics:
#     external:
#       metric: MetricIdentifier
#       target: MetricTarget
#     object:
#       describedObject: CrossVersionObjectReference
#       metric: MetricIdentifier
#       target: MetricTarget
#     pods:
#       metric: MetricIdentifier
#       target: MetricTarget
#     resource:
#       name: string
#       target: MetricTarget
#     type: string

# metrics:
#   - type: Resource
#     resource:
#       name: cpu
#       target:
#         type: Utilization
#         averageUtilization: 50
   
#   - type: Object
#     object:
#       target:
#         apiVersion: "apps/v1"
#         kind: deployment
#         name: cuda-test
#       metricName: "cuda_test_gpu_avg"
#       targetValue: 5

#   metrics:
#   - type: Object
#     object:
#       describedObject:
#         kind: Service
#         name: store-autoscale
#       metric:
#         name: "autoscaling.googleapis.com|gclb-capacity-utilization"
#       target:
#         averageValue: 70
#         type: AverageValue